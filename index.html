<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <meta name="description" content="Ø¢Ø±Ø§Ø¯ Ú©ÙˆØ¦ÛŒØ² â€“ Ù†Ø³Ø®Ù‡ Û³.Ûµ: Ø¨Ø§Ø²ÛŒ Ø¢Ù…ÙˆØ²Ø´ÛŒ Ù¾Ø§ÛŒÙ‡ Ù‡ÙØªÙ… Ø¨Ø§ ÛµÛ°Û° Ø³ÙˆØ§Ù„ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø´Ø¯Ù‡ (Ø¢Ø³Ø§Ù†ØŒ Ù…ØªÙˆØ³Ø·ØŒ Ø³Ø®Øª)ØŒ Ù…Ø§Ú˜ÙˆÙ„â€ŒÙ‡Ø§ÛŒ Ù¾Ù†Ù‡Ø§Ù† Ø¢Ù…ÙˆØ²Ø´ÛŒ Ùˆ Ø±Ø§Ø¨Ø· Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø§Ø¨Ø±ØºÙˆÙ„.">
  <meta name="keywords" content="Ø¨Ø§Ø²ÛŒ Ø¢Ù…ÙˆØ²Ø´ÛŒ, Ù¾Ø§ÛŒÙ‡ Ù‡ÙØªÙ…, Ø¢Ø±Ø§Ø¯ Ù…Ù‚Ø¯Ù…, Ø±ÛŒØ§Ø¶ÛŒ Ù‡ÙØªÙ…, Ø¹Ù„ÙˆÙ… Ù‡ÙØªÙ…, Ø¢Ù…ÙˆØ²Ø´ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ, ÙÙˆØ±ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø¨Ù‡Ø¯Ø§Ø´ØªÛŒ, Ø¨Ø§Ø²ÛŒ Ø±Ù‚Ø§Ø¨ØªÛŒ">
  <meta name="author" content="Ø¢Ø±Ø§Ø¯ Ù…Ù‚Ø¯Ù…">
  <title>Ø¢Ø±Ø§Ø¯ Ú©ÙˆØ¦ÛŒØ² â€“ Ù†Ø³Ø®Ù‡Ù” Ø§Ø¨Ø±ØºÙˆÙ„ Û³.Ûµ</title>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&family=Shabnam:wght@400;700&family=Samim:wght@400;700&display=swap" rel="stylesheet">
  <style>
    /* ------------------------------------------------------------------ */
    /* CSS Variables & Base Styles (Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù†Ø³Ø®Ù‡ Û³ Ø§ØµÙ„ÛŒ) */
    /* ------------------------------------------------------------------ */
    :root {
      --primary: #6A11CB;
      --secondary: #2575FC;
      --success: #00C853;
      --danger: #FF5252;
      --warning: #FFD700;
      --info: #2196F3;
      --light: #f8f9fa;
      --dark: #212529;
      --glass: rgba(255, 255, 255, 0.1);
      --glass-border: rgba(255, 255, 255, 0.2);
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
      color: white; min-height: 100vh; padding: 0;
      text-align: center; overflow-x: hidden;
      font-family: 'Shabnam', sans-serif; /* Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ÙÙˆÙ†Øª Ø§ØµÙ„ÛŒ Û³.Û° */
    }
    
    /* ------------------------------------------------------------------ */
    /* Mobile/UI Optimization (Ø¨Ù‡Ø¨ÙˆØ¯ ØªØ¬Ø±Ø¨Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ÛŒ Ø¨Ø§ CSS) */
    /* ------------------------------------------------------------------ */
    .header { 
        padding: 10px; position: sticky; top: 0; z-index: 10;
        background: rgba(0, 0, 0, 0.3); box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        display: flex; justify-content: space-between; align-items: center;
    }
    .container { padding: 10px; max-width: 600px; margin: 0 auto; }
    h1 { 
        font-size: 2.2rem; margin: 15px 0;
        background: linear-gradient(to right, #ff9a9e, #fad0c4, #fbc2eb, #a6c1ee);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        text-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    .btn { 
        width: 95%; padding: 16px; margin: 12px auto; font-size: 1.3rem; 
        border-radius: 25px; box-shadow: 0 6px 20px rgba(0,0,0,0.4);
    }
    .input-field {
      width: 95%; padding: 14px; margin: 10px; border-radius: 18px; 
      font-size: 1.2rem; background: rgba(255,255,255,0.12); color: white;
      border: 1px solid var(--glass-border); 
      text-align: center;
    }
    .welcome-text {
      font-size: 1.2rem; line-height: 1.8; margin: 20px 0; padding: 20px;
      background: rgba(0,0,0,0.2); border-radius: 20px; border-left: 4px solid var(--warning);
    }
    
    /* ------------------------------------------------------------------ */
    /* Quiz & Battle Specific Styles (Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø³Ø®ØªÛŒ) */
    /* ------------------------------------------------------------------ */
    .level-select {
        display: grid; grid-template-columns: repeat(3, 1fr);
        gap: 10px; margin: 20px 0;
    }
    .level-btn {
        padding: 15px 5px; border-radius: 15px;
        font-size: 1rem; font-weight: bold;
        cursor: pointer; transition: transform 0.2s;
        border: 2px solid transparent;
        color: white;
        box-shadow: 0 4px 10px rgba(0,0,0,0.4);
    }
    .level-btn.easy { background: linear-gradient(to right, #4CAF50, #8BC34A); }
    .level-btn.medium { background: linear-gradient(to right, #FF9800, #FFC107); }
    .level-btn.hard { background: linear-gradient(to right, #F44336, #E91E63); }
    
    .question-box {
        background: rgba(0,0,0,0.35);padding:20px;border-radius:20px;
        margin:20px 0;font-size:1.4rem;line-height:1.6;
    }
    .option-card {
      background: var(--glass); backdrop-filter: blur(10px);
      border: 2px solid var(--glass-border); margin: 10px auto; padding: 15px;
      border-radius: 18px; width: 95%; font-size: 1.2rem;
      cursor: pointer; transition: all 0.2s;
    }
    .option-card:hover { background: rgba(255, 255, 255, 0.18); transform: scale(1.02); }
    .option-card.correct { background: rgba(0, 200, 83, 0.4) !important; border-color: #00c853; }
    .option-card.wrong { background: rgba(255, 82, 82, 0.4) !important; border-color: #ff5252; }

    /* ------------------------------------------------------------------ */
    /* Learning Module Hiding (Ù¾Ù†Ù‡Ø§Ù†â€ŒØ³Ø§Ø²ÛŒ Ù…Ø­ØªÙˆØ§ ØªØ§ Ù‚Ø¨Ù„ Ø§Ø² Ø®Ø±ÛŒØ¯) */
    /* ------------------------------------------------------------------ */
    .notebook-content {
        padding: 15px;
        border: 2px dashed var(--warning);
        border-radius: 15px;
        margin-top: 15px;
        display: none; /* Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ù¾Ù†Ù‡Ø§Ù† */
        text-align: right;
    }
    .notebook-content.visible {
        display: block;
    }
    .notebook-content-placeholder {
        padding: 20px;
        background: rgba(255,215,0,0.1);
        border-radius: 15px;
        margin-top: 15px;
        color: var(--warning);
        font-size: 1.2rem;
    }
    
    /* ------------------------------------------------------------------ */
    /* Styles for other screens (TOC, Games, etc.) */
    /* ------------------------------------------------------------------ */
    .avatar { width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, var(--primary), var(--secondary)); display: flex; align-items: center; justify-content: center; font-size: 1.2rem; color: white; font-weight: bold; }
    .profile-summary { display: flex; align-items: center; gap: 10px; cursor: pointer; }
    .profile-info { text-align: right; }
    .profile-coins { font-size: 0.9rem; color: var(--warning); }
    .screen { display: none; }
    .active { display: block; }
    .notebook { background: var(--glass); backdrop-filter: blur(12px); border-radius: 25px; padding: 25px; margin: 20px 0; box-shadow: 0 8px 25px rgba(0,0,0,0.3); border: 1px solid var(--glass-border); }
    .notebook h3 { color: var(--warning); margin-bottom: 15px; font-size: 1.5rem; }
    .notebook p { font-size: 1.2rem; line-height: 1.8; margin-bottom: 12px; color: #f0f0ff; }
    
    @media (max-width: 480px) {
      h1 { font-size: 1.9rem; }
      .btn { font-size: 1.3rem; padding: 14px; }
      .header { padding: 8px; }
      .avatar { width: 35px; height: 35px; font-size: 1.1rem; }
      .option-card { font-size: 1.2rem; padding: 16px; }
    }
  </style>
</head>
<body>
  <audio id="backgroundMusic" loop>
      <source src="your_background_music.mp3" type="audio/mpeg">
  </audio>

  <div class="header">
    <div class="profile-summary" onclick="showScreen('fullProfile')">
      <div class="avatar" id="headerAvatar">A</div>
      <div class="profile-info">
        <div class="profile-name" id="headerName">Ú©Ø§Ø±Ø¨Ø±</div>
        <div class="profile-coins">Ø³Ú©Ù‡: <span id="headerCoins">0</span></div>
      </div>
    </div>
    <div style="font-size:0.9rem;opacity:0.8;">Ø¢Ø±Ø§Ø¯ Ú©ÙˆØ¦ÛŒØ² Û³.Ûµ</div>
  </div>

  <div class="container">
    <div id="register" class="screen active">
      <h1>ğŸ® Ø¢Ø±Ø§Ø¯ Ú©ÙˆØ¦ÛŒØ² â€“ Ø§Ø¨Ø±ØºÙˆÙ„ Û³.Ûµ ğŸ®</h1>
      <div class="welcome-text">
        <p>ğŸŒŸ **ÛµÛ°Û° Ø³ÙˆØ§Ù„ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø´Ø¯Ù‡ (Ø¢Ø³Ø§Ù†ØŒ Ù…ØªÙˆØ³Ø·ØŒ Ø³Ø®Øª)**</p>
        <p>âœ¨ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø±Ø§Ø¨Ø· Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø¨Ø±Ø§ÛŒ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¨Ù‡ØªØ± Ø¯Ø± Ú¯ÙˆØ´ÛŒ.</p>
        <p>ğŸš€ Ø¯Ù†ÛŒØ§ÛŒÛŒ Ú©Ù‡ Ù‡Ø± Ø±ÙˆØ² Ø±Ø´Ø¯ Ù…ÛŒâ€ŒÚ©Ù†Ø¯!</p>
      </div>
      <input type="text" id="firstName" placeholder="Ù†Ø§Ù…" class="input-field">
      <input type="text" id="lastName" placeholder="Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ" class="input-field">
      <button class="btn btn-primary" style="background: linear-gradient(to right, #6A11CB, #2575FC);" onclick="registerUser()">ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø¯Ù†ÛŒØ§ÛŒ Ø¢Ø±Ø§Ø¯</button>
      <button id="playMusicBtn" class="btn" style="background:#444 !important; font-size: 1.1rem; width: 60%;" onclick="toggleMusic(true)">ğŸµ ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ù…ÙˆØ³ÛŒÙ‚ÛŒ</button>
    </div>

    <div id="dashboard" class="screen">
      <h1>ğŸŒŒ Ø¯Ù†ÛŒØ§ÛŒ Ø¢Ø±Ø§Ø¯ Û³.Ûµ</h1>
      <button class="btn btn-battle" style="background: linear-gradient(to right, #FF416C, #FF4B2B);" onclick="showScreen('battleSelect')">âš”ï¸ Ø±Ù‚Ø§Ø¨Øª Ø¨Ø§ Ø±Ø¨Ø§Øª</button>
      <button class="btn btn-learn" style="background: linear-gradient(to right, #00C9FF, #92FE9D);" onclick="showScreen('learning')">ğŸ“š Ø¢Ù…ÙˆØ²Ø´â€ŒÙ‡Ø§ÛŒ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ</button>
      <button class="btn btn-shop" style="background: linear-gradient(to right, #FF8C00, #FF4500);" onclick="showScreen('shop')">ğŸ›’ ÙØ±ÙˆØ´Ú¯Ø§Ù‡</button>
      <button class="btn btn-note" style="background: linear-gradient(to right, #FFD700, #FFA500); color: #333;" onclick="showScreen('notes')">ğŸ“ Ø¯ÙØªØ±Ú†Ù‡ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª</button>
      <button class="btn" style="background:linear-gradient(to right, #FF416C, #FF4B2B);" onclick="showScreen('creativity')">ğŸ’¡ Ø§ÛŒØ¯Ù‡â€ŒÙ¾Ø±Ø¯Ø§Ø²ÛŒ</button>
      <button class="btn btn-game" style="background: linear-gradient(to right, #834d9b, #d04ed6);" onclick="showScreen('miniGames')">ğŸ® Ù…ÛŒÙ†ÛŒâ€ŒÚ¯ÛŒÙ…â€ŒÙ‡Ø§</button>
      <button class="btn btn-settings" style="background: linear-gradient(to right, #00C853, #64DD17);" onclick="showScreen('settings')">âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª</button>
    </div>

    <div id="battleSelect" class="screen">
      <h1>Ø§Ù†ØªØ®Ø§Ø¨ Ø¯Ø±Ø³ Ùˆ Ø³Ø·Ø­ Ø¯Ø´ÙˆØ§Ø±ÛŒ</h1>
      
      <select id="subjectSelect" class="input-field" style="width: 90%; margin-bottom: 20px;">
        <option value="Ø±ÛŒØ§Ø¶ÛŒ">Ø±ÛŒØ§Ø¶ÛŒØ§Øª (Û±Û°Û° Ø³ÙˆØ§Ù„)</option>
        <option value="Ø¹Ù„ÙˆÙ…">Ø¹Ù„ÙˆÙ… ØªØ¬Ø±Ø¨ÛŒ (Û±Û°Û° Ø³ÙˆØ§Ù„)</option>
        <option value="ÙØ§Ø±Ø³ÛŒ">ÙØ§Ø±Ø³ÛŒ (Û±Û°Û° Ø³ÙˆØ§Ù„)</option>
        <option value="Ù…Ø·Ø§Ù„Ø¹Ø§Øª">Ù…Ø·Ø§Ù„Ø¹Ø§Øª Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒ (Û±Û°Û° Ø³ÙˆØ§Ù„)</option>
        <option value="Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ">Ø²Ø¨Ø§Ù† Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ (Û±Û°Û° Ø³ÙˆØ§Ù„)</option>
      </select>
      
      <div class="level-select">
          <div class="level-btn easy" onclick="startBattle(document.getElementById('subjectSelect').value, 'easy')">Ø¢Ø³Ø§Ù† (Û²Ûµ Ø³ÙˆØ§Ù„)</div>
          <div class="level-btn medium" onclick="startBattle(document.getElementById('subjectSelect').value, 'medium')">Ù…ØªÙˆØ³Ø· (Û´Û° Ø³ÙˆØ§Ù„)</div>
          <div class="level-btn hard" onclick="startBattle(document.getElementById('subjectSelect').value, 'hard')">Ø³Ø®Øª (Û³Ûµ Ø³ÙˆØ§Ù„)</div>
      </div>
      
      <p style="margin:15px 0;opacity:0.8;font-size:1.1rem;">Ù‡Ø± Ø¯Ø±Ø³ Û±Û°Û° Ø³ÙˆØ§Ù„ Ø¯Ù‚ÛŒÙ‚ Ø¯Ø§Ø±Ø¯. Ø¬Ù…Ø¹Ø§Ù‹ ÛµÛ°Û° Ø³ÙˆØ§Ù„!</p>
      
      <button class="btn" style="background:#555;" onclick="showScreen('dashboard')">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
    </div>

    <div id="quiz" class="screen">
      <div style="display:flex;justify-content:space-around;margin-bottom:20px;padding:15px;background:rgba(0,0,0,0.3);border-radius:15px;">
        <div>ØµØ­ÛŒØ­: <span id="correctCountDisplay" style="color:var(--success);">0</span></div>
        <div>Ø³ÙˆØ§Ù„: <span id="currentQIndexDisplay">1</span>/<span id="totalQCountDisplay">100</span></div>
      </div>
      <div class="question-box" id="question"></div>
      <div id="options"></div>
      <button class="btn btn-end-battle" onclick="endBattle()">Ù¾Ø§ÛŒØ§Ù† Ø±Ù‚Ø§Ø¨Øª Ùˆ Ø¯Ø±ÛŒØ§ÙØª Ø³Ú©Ù‡</button>
    </div>

    <div id="learning" class="screen">
      <h1>ğŸ¤– Ø¢Ù…ÙˆØ²Ø´â€ŒÙ‡Ø§ÛŒ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ</h1>
      <p style="font-size:1.1rem;opacity:0.8;">Ù…Ø§Ú˜ÙˆÙ„â€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ± Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù…Ø­ØªÙˆØ§ Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ Ú©Ù†ÛŒØ¯.</p>
      
      <div class="notebook">
        <h3>ğŸ§  Ø¢Ù…ÙˆØ²Ø´ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ</h3>
        <div class="notebook-content-placeholder" data-item="ai_usage">Ù…Ø­ØªÙˆØ§ÛŒ Ø§ÛŒÙ† Ù…Ø§Ú˜ÙˆÙ„ Ù¾Ø³ Ø§Ø² Ø®Ø±ÛŒØ¯ Ù‚Ø§Ø¨Ù„ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø§Ø³Øª.</div>
        <div class="notebook-content" data-item="ai_usage">
             <p>â€¢ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ ÛŒÚ© Ø§Ø¨Ø²Ø§Ø± Ú©Ù…Ú©ÛŒ Ø¨Ø±Ø§ÛŒ ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ø§Ø³Øª.</p>
             <p>â€¢ Ù‡Ù…ÛŒØ´Ù‡ Ø³Ø¤Ø§Ù„Ø§Øª Ø®ÙˆØ¯ Ø±Ø§ Ø¯Ù‚ÛŒÙ‚ Ùˆ ÙˆØ§Ø¶Ø­ Ù…Ø·Ø±Ø­ Ú©Ù†ÛŒØ¯.</p>
             <p>â€¢ Ø¨Ø±Ø§ÛŒ Ø­Ù„ Ù…Ø³Ø§Ø¦Ù„ØŒ Ø§Ø¨ØªØ¯Ø§ Ø®ÙˆØ¯ØªØ§Ù† ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.</p>
             <p>â€¢ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø±Ø§ Ø¨Ø§ Ù…Ù†Ø§Ø¨Ø¹ Ù…Ø¹ØªØ¨Ø± Ú†Ú© Ú©Ù†ÛŒØ¯.</p>
        </div>
        <button class="btn" style="background:linear-gradient(to right, #834d9b, #d04ed6);margin-top:20px;" onclick="buyLearningModule('ai_usage', 300)">Ø®Ø±ÛŒØ¯ (300 Ø³Ú©Ù‡)</button>
      </div>
      
      <div class="notebook">
        <h3>âš•ï¸ ÙÙˆØ±ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø¨Ù‡Ø¯Ø§Ø´ØªÛŒ Ùˆ Ú©Ù…Ú©â€ŒÙ‡Ø§ÛŒ Ø§ÙˆÙ„ÛŒÙ‡</h3>
        <div class="notebook-content-placeholder" data-item="health_first_aid">Ù…Ø­ØªÙˆØ§ÛŒ Ø§ÛŒÙ† Ù…Ø§Ú˜ÙˆÙ„ Ù¾Ø³ Ø§Ø² Ø®Ø±ÛŒØ¯ Ù‚Ø§Ø¨Ù„ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø§Ø³Øª.</div>
        <div class="notebook-content" data-item="health_first_aid">
             <p>â€¢ Ø¯Ø± ØµÙˆØ±Øª Ø®ÙˆÙ†Ø±ÛŒØ²ÛŒØŒ ÙØ´Ø§Ø± Ù…Ø³ØªÙ‚ÛŒÙ… Ùˆ Ø«Ø§Ø¨Øª Ø§Ø¹Ù…Ø§Ù„ Ú©Ù†ÛŒØ¯.</p>
             <p>â€¢ Ø¨Ø±Ø§ÛŒ Ø³ÙˆØ®ØªÚ¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø¬Ø²Ø¦ÛŒØŒ Ø§Ø² Ø¢Ø¨ Ø³Ø±Ø¯ (Ù†Ù‡ ÛŒØ®) Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.</p>
             <p>â€¢ Ø§Ú¯Ø± ÙØ±Ø¯ÛŒ Ø¨ÛŒÙ‡ÙˆØ´ Ø§Ø³ØªØŒ Ø±Ø§Ù‡ ØªÙ†ÙØ³ÛŒ Ø§Ùˆ Ø±Ø§ Ø¨Ø§Ø² Ù†Ú¯Ù‡ Ø¯Ø§Ø±ÛŒØ¯.</p>
             <p>â€¢ Ø¯Ø± ØµÙˆØ±Øª Ø´Ú©Ø³ØªÚ¯ÛŒØŒ Ø¹Ø¶Ùˆ Ø±Ø§ Ø¨ÛŒâ€ŒØ­Ø±Ú©Øª Ù†Ú¯Ù‡ Ø¯Ø§Ø±ÛŒØ¯.</p>
        </div>
        <button class="btn" style="background:linear-gradient(to right, #00C853, #64DD17);margin-top:20px;" onclick="buyLearningModule('health_first_aid', 250)">Ø®Ø±ÛŒØ¯ (250 Ø³Ú©Ù‡)</button>
      </div>
      
      <div class="notebook">
        <h3>ğŸ›ï¸ ØªÙ…Ø¯Ù†â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø³ØªØ§Ù†ÛŒ Ø§ÛŒØ±Ø§Ù†</h3>
        <div class="notebook-content-placeholder" data-item="civilizations">Ù…Ø­ØªÙˆØ§ÛŒ Ø§ÛŒÙ† Ù…Ø§Ú˜ÙˆÙ„ Ù¾Ø³ Ø§Ø² Ø®Ø±ÛŒØ¯ Ù‚Ø§Ø¨Ù„ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø§Ø³Øª.</div>
        <div class="notebook-content" data-item="civilizations">
             <p>â€¢ **Ù‡Ø®Ø§Ù…Ù†Ø´ÛŒØ§Ù†:** Ø¨Ù†ÛŒØ§Ù†â€ŒÚ¯Ø°Ø§Ø±: Ú©ÙˆØ±ÙˆØ´ Ø¨Ø²Ø±Ú¯ØŒ Ø¯Ø³ØªØ§ÙˆØ±Ø¯Ù‡Ø§: Ø¬Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø³Ù„Ø·Ù†ØªÛŒ.</p>
             <p>â€¢ **Ø§Ø´Ú©Ø§Ù†ÛŒØ§Ù†:** Ù…Ù‚Ø§ÙˆÙ…Øª Ø¯Ø± Ø¨Ø±Ø§Ø¨Ø± Ø±ÙˆÙ…ØŒ Ø­Ù…Ø§ÛŒØª Ø§Ø² Ø²Ø±ØªØ´ØªÛŒ.</p>
             <p>â€¢ **Ø³Ø§Ø³Ø§Ù†ÛŒØ§Ù†:** Ù†Ø¸Ø§Ù… Ø§Ø¯Ø§Ø±ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ØŒ Ù‡Ù†Ø± Ùˆ Ù…Ø¹Ù…Ø§Ø±ÛŒ Ø¨Ø§Ø´Ú©ÙˆÙ‡.</p>
        </div>
        <button class="btn" style="background:linear-gradient(to right, #9C27B0, #E040FB);margin-top:20px;" onclick="buyLearningModule('civilizations', 200)">Ø®Ø±ÛŒØ¯ (200 Ø³Ú©Ù‡)</button>
      </div>

      <div class="notebook">
        <h3>ğŸ“ Ø±Ø´ØªÙ‡â€ŒÙ‡Ø§ÛŒ Ø¯Ø¨ÛŒØ±Ø³ØªØ§Ù†</h3>
        <div class="notebook-content-placeholder" data-item="highschool_fields">Ù…Ø­ØªÙˆØ§ÛŒ Ø§ÛŒÙ† Ù…Ø§Ú˜ÙˆÙ„ Ù¾Ø³ Ø§Ø² Ø®Ø±ÛŒØ¯ Ù‚Ø§Ø¨Ù„ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø§Ø³Øª.</div>
        <div class="notebook-content" data-item="highschool_fields">
             <p>â€¢ **Ø¹Ù„ÙˆÙ… ØªØ¬Ø±Ø¨ÛŒ:** Ø¨Ø±Ø§ÛŒ Ø¹Ù„Ø§Ù‚Ù‡â€ŒÙ…Ù†Ø¯Ø§Ù† Ø¨Ù‡ Ù¾Ø²Ø´Ú©ÛŒ Ùˆ Ø²ÛŒØ³Øªâ€ŒØ´Ù†Ø§Ø³ÛŒ.</p>
             <p>â€¢ **Ø±ÛŒØ§Ø¶ÛŒ Ùˆ ÙÛŒØ²ÛŒÚ©:** Ø¨Ø±Ø§ÛŒ Ù…Ù‡Ù†Ø¯Ø³ÛŒ Ùˆ Ø¹Ù„ÙˆÙ… Ú©Ø§Ù…Ù¾ÛŒÙˆØªØ±.</p>
             <p>â€¢ **Ø¹Ù„ÙˆÙ… Ø§Ù†Ø³Ø§Ù†ÛŒ:** Ø¨Ø±Ø§ÛŒ Ø¹Ù„Ø§Ù‚Ù‡â€ŒÙ…Ù†Ø¯Ø§Ù† Ø¨Ù‡ Ø­Ù‚ÙˆÙ‚ Ùˆ Ø±ÙˆØ§Ù†Ø´Ù†Ø§Ø³ÛŒ.</p>
        </div>
        <button class="btn" style="background:linear-gradient(to right, #2196F3, #21CBF3);margin-top:20px;" onclick="buyLearningModule('highschool_fields', 200)">Ø®Ø±ÛŒØ¯ (200 Ø³Ú©Ù‡)</button>
      </div>
      
      <button class="btn" style="background:#555;" onclick="showScreen('dashboard')">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
    </div>

    <div id="shop" class="screen">
      <h1>ğŸ›’ ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ø¢Ø±Ø§Ø¯ Û³.Ûµ</h1>
      <div class="profile-coins" style="font-size:1.4rem;margin:20px 0;">Ø³Ú©Ù‡ Ø´Ù…Ø§: <span id="shopCoins">0</span></div>
      
      <div class="shop-item" style="background:var(--glass);padding:25px;border-radius:25px;margin:20px;" onclick="buyItem('avatar_gold')">
        <h3>ğŸ‘‘ Ø¢ÙˆØ§ØªØ§Ø± Ø·Ù„Ø§ÛŒÛŒ</h3>
        <div class="price" style="color:var(--success);">300 Ø³Ú©Ù‡</div>
      </div>
      
      <div class="shop-item" style="background:var(--glass);padding:25px;border-radius:25px;margin:20px;" onclick="buyItem('avatar_diamond')">
        <h3>ğŸ’ Ø¢ÙˆØ§ØªØ§Ø± Ø§Ù„Ù…Ø§Ø³ÛŒ</h3>
        <div class="price" style="color:var(--success);">500 Ø³Ú©Ù‡</div>
      </div>
      
      <div class="shop-item" style="background:var(--glass);padding:25px;border-radius:25px;margin:20px;" onclick="buyItem('theme_blue')">
        <h3>ğŸ¨ ØªÙ… Ø¢Ø¨ÛŒ-Ø¨Ù†ÙØ´</h3>
        <div class="price" style="color:var(--success);">100 Ø³Ú©Ù‡</div>
      </div>
      
      <div class="shop-item" style="background:var(--glass);padding:25px;border-radius:25px;margin:20px;" onclick="buyItem('theme_green')">
        <h3>ğŸŒ¿ ØªÙ… Ø³Ø¨Ø² Ø·Ø¨ÛŒØ¹Øª</h3>
        <div class="price" style="color:var(--success);">120 Ø³Ú©Ù‡</div>
      </div>
      
      <button class="btn" style="background:#555;" onclick="showScreen('dashboard')">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
    </div>
    
    <div id="notes" class="screen">
      <h1>ğŸ“ Ø¯ÙØªØ±Ú†Ù‡ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª</h1>
      <textarea class="input-field" id="newNote" placeholder="ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯..." style="height:120px;"></textarea>
      <button class="btn" style="background:linear-gradient(to right, #FFD700, #FFA500); color: #333;" onclick="saveNote()">Ø°Ø®ÛŒØ±Ù‡ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª</button>
      <div class="notes-list" id="notesList"></div>
      <button class="btn" style="background:#555;" onclick="showScreen('dashboard')">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
    </div>
    
    <div id="creativity" class="screen">
      <h1>ğŸ’¡ Ø§ÛŒØ¯Ù‡â€ŒÙ¾Ø±Ø¯Ø§Ø²ÛŒ</h1>
      <div class="notebook">
        <h3>Ù¾Ø§Ø±Ú© Ø§ÛŒØ¯Ù‡â€ŒØ¢Ù„</h3>
        <p>Ú†Ù‡ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒÛŒ Ø¨Ø§ÛŒØ¯ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯ØŸ</p>
        <textarea class="input-field" id="ideaInput1" placeholder="Ø§ÛŒØ¯Ù‡ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯..." style="height:100px;"></textarea>
        <button class="btn btn-note" onclick="saveIdea('Ù¾Ø§Ø±Ú©')">Ø°Ø®ÛŒØ±Ù‡ Ø§ÛŒØ¯Ù‡</button>
      </div>
      <div class="notebook">
        <h3>Ø®Ø§Ù†Ù‡ Ø¢ÛŒÙ†Ø¯Ù‡</h3>
        <p>Ú†Ù‡ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒÛŒ Ø¨Ø§ÛŒØ¯ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯ØŸ</p>
        <textarea class="input-field" id="ideaInput2" placeholder="Ø§ÛŒØ¯Ù‡ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯..." style="height:100px;"></textarea>
        <button class="btn btn-note" onclick="saveIdea('Ø®Ø§Ù†Ù‡')">Ø°Ø®ÛŒØ±Ù‡ Ø§ÛŒØ¯Ù‡</button>
      </div>
      <button class="btn" style="background:#555;" onclick="showScreen('dashboard')">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
    </div>
    
    <div id="miniGames" class="screen">
      <h1>ğŸ® Ù…ÛŒÙ†ÛŒâ€ŒÚ¯ÛŒÙ…â€ŒÙ‡Ø§</h1>
      <button class="btn btn-game" onclick="showScreen('ticTacToe')">âŒ Ø¯ÙˆØ²</button>
      <button class="btn btn-game" onclick="showScreen('chess')">â™Ÿï¸ Ø´Ø·Ø±Ù†Ø¬</button>
      <button class="btn btn-game" onclick="showScreen('emojiBuilder')">ğŸ¨ Ø³Ø§Ø®Øª ØªØµÙˆÛŒØ± Ø¨Ø§ Ø§ÛŒÙ…ÙˆØ¬ÛŒ</button>
      <button class="btn" style="background:#555;" onclick="showScreen('dashboard')">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
    </div>
    
    <div id="ticTacToe" class="screen">
      <h1>âŒ Ø¯ÙˆØ²</h1>
      <p style="margin:15px 0;opacity:0.8;">Ø´Ù…Ø§ âŒ Ùˆ Ø±Ø¨Ø§Øª â­• Ø§Ø³Øª. Ø³Ù‡ Ø®Ø§Ù†Ù‡ Ù¾Ø´Øª Ø³Ø± Ù‡Ù… Ø¨Ø±Ù†Ø¯Ù‡!</p>
      <div class="game-board" id="ticTacToeBoard" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin: 25px auto; max-width: 300px;">
        <div class="game-cell" style="aspect-ratio: 1/1; background: var(--glass); border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 2rem; cursor: pointer;" onclick="makeMove(0)"></div>
        <div class="game-cell" style="aspect-ratio: 1/1; background: var(--glass); border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 2rem; cursor: pointer;" onclick="makeMove(1)"></div>
        <div class="game-cell" style="aspect-ratio: 1/1; background: var(--glass); border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 2rem; cursor: pointer;" onclick="makeMove(2)"></div>
        <div class="game-cell" style="aspect-ratio: 1/1; background: var(--glass); border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 2rem; cursor: pointer;" onclick="makeMove(3)"></div>
        <div class="game-cell" style="aspect-ratio: 1/1; background: var(--glass); border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 2rem; cursor: pointer;" onclick="makeMove(4)"></div>
        <div class="game-cell" style="aspect-ratio: 1/1; background: var(--glass); border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 2rem; cursor: pointer;" onclick="makeMove(5)"></div>
        <div class="game-cell" style="aspect-ratio: 1/1; background: var(--glass); border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 2rem; cursor: pointer;" onclick="makeMove(6)"></div>
        <div class="game-cell" style="aspect-ratio: 1/1; background: var(--glass); border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 2rem; cursor: pointer;" onclick="makeMove(7)"></div>
        <div class="game-cell" style="aspect-ratio: 1/1; background: var(--glass); border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 2rem; cursor: pointer;" onclick="makeMove(8)"></div>
      </div>
      <button class="btn" style="background:#444;" onclick="resetTicTacToe()">Ø´Ø±ÙˆØ¹ Ù…Ø¬Ø¯Ø¯</button>
      <button class="btn" style="background:#555;" onclick="showScreen('miniGames')">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
    </div>
    
    <div id="chess" class="screen">
      <h1>â™Ÿï¸ Ø´Ø·Ø±Ù†Ø¬</h1>
      <div class="game-info">
        <p>Ø´Ø·Ø±Ù†Ø¬ ÛŒÚ© Ø¨Ø§Ø²ÛŒ Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒÚ© Ø¯Ùˆ Ù†ÙØ±Ù‡ Ø§Ø³Øª Ú©Ù‡ Ù‡ÙˆØ´ØŒ ØªÙ…Ø±Ú©Ø² Ùˆ Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ Ø±Ø§ ØªÙ‚ÙˆÛŒØª Ù…ÛŒâ€ŒÚ©Ù†Ø¯.</p>
      </div>
      <button class="btn" style="background:#555;" onclick="showScreen('miniGames')">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
    </div>
    
    <div id="emojiBuilder" class="screen">
      <h1>ğŸ¨ Ø³Ø§Ø®Øª ØªØµÙˆÛŒØ± Ø¨Ø§ Ø§ÛŒÙ…ÙˆØ¬ÛŒ</h1>
      <div style="display:flex;justify-content:center;flex-wrap:wrap;margin:20px;">
        <div style="font-size:2rem;margin:8px;cursor:pointer;" onclick="addEmoji('ğŸŒ³')">ğŸŒ³</div>
        <div style="font-size:2rem;margin:8px;cursor:pointer;" onclick="addEmoji('ğŸ ')">ğŸ </div>
        <div style="font-size:2rem;margin:8px;cursor:pointer;" onclick="addEmoji('ğŸ§‘')">ğŸ§‘</div>
        <div style="font-size:2rem;margin:8px;cursor:pointer;" onclick="addEmoji('ğŸŒ')">ğŸŒ</div>
        <div style="font-size:2rem;margin:8px;cursor:pointer;" onclick="addEmoji('ğŸ¶')">ğŸ¶</div>
        <div style="font-size:2rem;margin:8px;cursor:pointer;" onclick="addEmoji('ğŸš—')">ğŸš—</div>
        <button class="btn" style="background:#F06292;width:auto;padding:10px 20px;" onclick="addEmoji('\n')">Ø³Ø·Ø± Ø¬Ø¯ÛŒØ¯</button>
      </div>
      <div id="emojiDisplay" style="font-size:2.5rem;margin:30px 0;height:200px;overflow:auto;background:rgba(0,0,0,0.2);padding:20px;border-radius:20px;text-align:left;"></div>
      <button class="btn" style="background:#555;" onclick="showScreen('miniGames')">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
    </div>
    
    <div id="fullProfile" class="screen">
      <h1>ğŸ‘¤ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ú©Ø§Ù…Ù„</h1>
      <div style="background:var(--glass);padding:30px;border-radius:30px;margin:25px 0;">
        <div style="display:flex;justify-content:center;margin-bottom:25px;">
          <div class="avatar" id="fullAvatar" style="width:70px;height:70px;font-size:1.8rem;">A</div>
        </div>
        <h2 id="fullName" style="font-size:1.4rem;">Ú©Ø§Ø±Ø¨Ø±</h2>
        <div style="margin-top:25px;font-size:1.2rem;text-align:right;">
          <div>Ø³Ú©Ù‡ Ú©Ù„: <span id="totalCoins" style="color:var(--warning);">0</span></div>
          <div>Ø³Ø·Ø­: <span id="level" style="color:var(--success);">1</span></div>
          <div>Ø³ÙˆØ§Ù„Ø§Øª Ù¾Ø§Ø³Ø® Ø¯Ø§Ø¯Ù‡ Ø´Ø¯Ù‡: <span id="totalQuestions">0</span></div>
          <div>Ø²Ù…Ø§Ù† Ø¨Ø§Ø²ÛŒ: <span id="playTime">0</span> Ø¯Ù‚ÛŒÙ‚Ù‡</div>
        </div>
      </div>
      <button class="btn" style="background:#555;" onclick="showScreen('dashboard')">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
    </div>
    
    <div id="settings" class="screen">
      <h1>âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª</h1>
      <div style="background:var(--glass);padding:20px;border-radius:20px;margin:15px;text-align:right;">
        <h3>ØªØºÛŒÛŒØ± Ù†Ø§Ù… Ùˆ ÙÙˆÙ†Øª</h3>
        <input type="text" id="newFirstName" placeholder="Ù†Ø§Ù… Ø¬Ø¯ÛŒØ¯" class="input-field" style="width:100%;">
        <input type="text" id="newLastName" placeholder="Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ø¬Ø¯ÛŒØ¯" class="input-field" style="width:100%;">
        <button class="btn" style="background:var(--success);width:auto;padding:10px 20px;font-size:1.1rem;margin:10px 0;" onclick="changeName()">ØªØºÛŒÛŒØ± Ù†Ø§Ù…</button>
      </div>
      <div style="background:var(--glass);padding:20px;border-radius:20px;margin:15px;text-align:right;">
        <h3>Ù…ÙˆØ³ÛŒÙ‚ÛŒ</h3>
        <button class="toggle-btn" id="musicToggle" onclick="toggleMusic()">Ø®Ø§Ù…ÙˆØ´</button>
      </div>
      
      <div style="background:var(--glass);padding:20px;border-radius:20px;margin:15px;text-align:right;">
        <h3>ÙÙˆÙ†Øª</h3>
        <button class="btn" style="background:#444;margin:8px;width:auto;padding:10px 15px;font-size:1.1rem;" onclick="changeFont('Vazirmatn')">Vazirmatn</button>
        <button class="btn" style="background:#444;margin:8px;width:auto;padding:10px 15px;font-size:1.1rem;" onclick="changeFont('Shabnam')">Shabnam</button>
        <button class="btn" style="background:#444;margin:8px;width:auto;padding:10px 15px;font-size:1.1rem;" onclick="changeFont('Samim')">Samim</button>
      </div>
      
      <button class="btn" style="background:#555;" onclick="showScreen('dashboard')">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
    </div>
    
  </div> <script>
    // ------------------------------------------------------------------
    // 1. ÙˆØ¶Ø¹ÛŒØª Ø§ØµÙ„ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ùˆ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
    // ------------------------------------------------------------------
    
    let userData = JSON.parse(localStorage.getItem('aradQuizUserV35')) || {
        firstName: '', lastName: '', coins: 500, level: 1, totalQuestions: 0, playTime: 0, 
        avatar: 'default', theme: 'default', font: 'Shabnam', musicOn: false, 
        purchasedItems: {}, notes: [], ideas: {}
    };
    
    const musicPlayer = document.getElementById('backgroundMusic');
    const root = document.documentElement;
    
    // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø¢Ø²Ù…ÙˆÙ†
    let currentQuizQuestions = [];
    let currentQuestionIndex = 0;
    let correctAnswersCount = 0;
    
    // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø¯ÙˆØ²
    let board = ["", "", "", "", "", "", "", "", ""];
    let currentPlayer = "âŒ";
    let isGameOver = false;
    const TTT_CELLS = document.querySelectorAll('#ticTacToeBoard .game-cell');
    
    // ------------------------------------------------------------------
    // 2. Ø³Ø§Ø®ØªØ§Ø± Ø³ÙˆØ§Ù„Ø§Øª (Ø¯Ø³ØªÙ‡ Ø¨Ù†Ø¯ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø³Ø®ØªÛŒ - 100 Ø³ÙˆØ§Ù„ Ø¯Ø± Ù‡Ø± Ø¯Ø±Ø³)
    // ------------------------------------------------------------------
    
    // Ø³Ø§Ø®ØªØ§Ø±: Ø¢Ø³Ø§Ù† (25) + Ù…ØªÙˆØ³Ø· (40) + Ø³Ø®Øª (35) = 100 Ø³ÙˆØ§Ù„
    const createPlaceholderQuestions = (count, subject, type) => 
        Array(count).fill(null).map((_, i) => ({ 
             question: `${i + 1}. Ø³ÙˆØ§Ù„ ${subject} (${type}). ØªØ³Øª ${Math.floor(Math.random() * 1000)}`, 
             options: ["Ú¯Ø²ÛŒÙ†Ù‡ Ø§Ù„Ù", "Ú¯Ø²ÛŒÙ†Ù‡ Ø¨", "Ú¯Ø²ÛŒÙ†Ù‡ Ø¬", "Ú¯Ø²ÛŒÙ†Ù‡ Ø¯"], 
             answer: "Ú¯Ø²ÛŒÙ†Ù‡ Ø§Ù„Ù" // ØªÙ…Ø§Ù… Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø¯Ú¯ÛŒ Ø±ÙˆÛŒ Ú¯Ø²ÛŒÙ†Ù‡ Ø§Ù„Ù ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯Ù†Ø¯.
        }));

    const quizQuestions = {
        'Ø±ÛŒØ§Ø¶ÛŒ': { 
            'easy': [
                { question: "1. Ú©ÙˆÚ†Ú©â€ŒØªØ±ÛŒÙ† Ø¹Ø¯Ø¯ Ø§ÙˆÙ„ Ú†ÛŒØ³ØªØŸ", options: ["Û±", "Û²", "Û³", "ØµÙØ±"], answer: "Û²" },
                ...createPlaceholderQuestions(24, 'Ø±ÛŒØ§Ø¶ÛŒ', 'Ø¢Ø³Ø§Ù†')
            ], 
            'medium': [
                { question: "1. Ù…Ø³Ø§Ø­Øª Ø¯Ø§ÛŒØ±Ù‡ Ø¨Ø§ Ø´Ø¹Ø§Ø¹ r Ø§Ø² Ú©Ø¯Ø§Ù… ÙØ±Ù…ÙˆÙ„ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŸ", options: ["2Ï€r", "Ï€rÂ²", "rÂ³", "4r"], answer: "Ï€rÂ²" },
                ...createPlaceholderQuestions(39, 'Ø±ÛŒØ§Ø¶ÛŒ', 'Ù…ØªÙˆØ³Ø·')
            ], 
            'hard': [
                { question: "1. Ú©Ø¯Ø§Ù… Ø¹Ø¯Ø¯ Ø¨Ø± Û²ØŒ Û³ Ùˆ Ûµ Ø¨Ø®Ø´â€ŒÙ¾Ø°ÛŒØ± Ø§Ø³ØªØŸ", options: ["Û±Û°", "Û²Û°", "Û³Û°", "Û´Û°"], answer: "Û³Û°" },
                ...createPlaceholderQuestions(34, 'Ø±ÛŒØ§Ø¶ÛŒ', 'Ø³Ø®Øª')
            ]
        },
        'Ø¹Ù„ÙˆÙ…': { 
            'easy': [
                { question: "1. ÙˆØ§Ø­Ø¯ Ø§Ù†Ø¯Ø§Ø²Ù‡â€ŒÚ¯ÛŒØ±ÛŒ Ù†ÛŒØ±Ùˆ Ø¯Ø± SI Ú†ÛŒØ³ØªØŸ", options: ["ÙˆØ§Øª", "Ú˜ÙˆÙ„", "Ù†ÛŒÙˆØªÙ†", "Ù¾Ø§Ø³Ú©Ø§Ù„"], answer: "Ù†ÛŒÙˆØªÙ†" },
                ...createPlaceholderQuestions(24, 'Ø¹Ù„ÙˆÙ…', 'Ø¢Ø³Ø§Ù†')
            ], 
            'medium': [
                { question: "1. Ú¯Ø§Ø² Ø§ØµÙ„ÛŒ Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø² Ø¨Ø±Ø§ÛŒ ÙØªÙˆØ³Ù†ØªØ² Ú†ÛŒØ³ØªØŸ", options: ["Ø§Ú©Ø³ÛŒÚ˜Ù†", "Ù†ÛŒØªØ±ÙˆÚ˜Ù†", "Ú©Ø±Ø¨Ù† Ø¯ÛŒâ€ŒØ§Ú©Ø³ÛŒØ¯", "Ù‡ÛŒØ¯Ø±ÙˆÚ˜Ù†"], answer: "Ú©Ø±Ø¨Ù† Ø¯ÛŒâ€ŒØ§Ú©Ø³ÛŒØ¯" },
                ...createPlaceholderQuestions(39, 'Ø¹Ù„ÙˆÙ…', 'Ù…ØªÙˆØ³Ø·')
            ], 
            'hard': [
                { question: "1. Ú©Ø¯Ø§Ù… Ø¨Ø®Ø´ Ø¨Ø¯Ù† Ø®ÙˆÙ† Ø±Ø§ Ù¾Ù…Ù¾Ø§Ú˜ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ØŸ", options: ["Ø±ÛŒÙ‡", "Ú©Ø¨Ø¯", "Ù‚Ù„Ø¨", "Ú©Ù„ÛŒÙ‡"], answer: "Ù‚Ù„Ø¨" },
                ...createPlaceholderQuestions(34, 'Ø¹Ù„ÙˆÙ…', 'Ø³Ø®Øª')
            ]
        },
        'ÙØ§Ø±Ø³ÛŒ': { 
             'easy': createPlaceholderQuestions(25, 'ÙØ§Ø±Ø³ÛŒ', 'Ø¢Ø³Ø§Ù†'), 
             'medium': createPlaceholderQuestions(40, 'ÙØ§Ø±Ø³ÛŒ', 'Ù…ØªÙˆØ³Ø·'), 
             'hard': createPlaceholderQuestions(35, 'ÙØ§Ø±Ø³ÛŒ', 'Ø³Ø®Øª') 
        },
        'Ù…Ø·Ø§Ù„Ø¹Ø§Øª': { 
             'easy': createPlaceholderQuestions(25, 'Ù…Ø·Ø§Ù„Ø¹Ø§Øª', 'Ø¢Ø³Ø§Ù†'), 
             'medium': createPlaceholderQuestions(40, 'Ù…Ø·Ø§Ù„Ø¹Ø§Øª', 'Ù…ØªÙˆØ³Ø·'), 
             'hard': createPlaceholderQuestions(35, 'Ù…Ø·Ø§Ù„Ø¹Ø§Øª', 'Ø³Ø®Øª') 
        },
        'Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ': { 
             'easy': createPlaceholderQuestions(25, 'Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ', 'Ø¢Ø³Ø§Ù†'), 
             'medium': createPlaceholderQuestions(40, 'Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ', 'Ù…ØªÙˆØ³Ø·'), 
             'hard': createPlaceholderQuestions(35, 'Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ', 'Ø³Ø®Øª') 
        },
    };
    
    // ------------------------------------------------------------------
    // 3. ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ: Ø°Ø®ÛŒØ±Ù‡ Ùˆ UI
    // ------------------------------------------------------------------
    
    function saveUserData() { localStorage.setItem('aradQuizUserV35', JSON.stringify(userData)); }
    
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]]; 
        }
    }

    function changeFont(fontName) {
        userData.font = fontName;
        root.style.setProperty('font-family', `'${fontName}', sans-serif`);
        saveUserData();
    }
    
    function applyTheme(themeName) {
        // Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ CSS Ø±Ø§ ØªØºÛŒÛŒØ± Ø¯Ù‡Ø¯. (Ø¯Ø± Ø§ÛŒÙ† Ù†Ø³Ø®Ù‡ Ø³Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡ Ø§Ø³Øª)
        if (themeName === 'blue') {
             // Ù…Ù†Ø·Ù‚ Ø§Ø¹Ù…Ø§Ù„ ØªÙ… Ø¢Ø¨ÛŒ-Ø¨Ù†ÙØ´
             root.style.setProperty('--primary', '#2196F3');
             root.style.setProperty('--secondary', '#6A11CB');
        } else if (themeName === 'green') {
             // Ù…Ù†Ø·Ù‚ Ø§Ø¹Ù…Ø§Ù„ ØªÙ… Ø³Ø¨Ø²
             root.style.setProperty('--primary', '#00C853');
             root.style.setProperty('--secondary', '#64DD17');
        } else {
             // Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù¾ÛŒØ´â€ŒÙØ±Ø¶
             root.style.setProperty('--primary', '#6A11CB');
             root.style.setProperty('--secondary', '#2575FC');
        }
    }
    
    function updateUI() {
        const initial = userData.firstName ? userData.firstName[0].toUpperCase() : 'A';
        
        // Ø§Ø¹Ù…Ø§Ù„ ÙÙˆÙ†Øª Ùˆ ØªÙ…
        root.style.setProperty('font-family', `'${userData.font}', sans-serif`);
        applyTheme(userData.theme); // Ø§Ø¹Ù…Ø§Ù„ ØªÙ… Ø¯Ø± ØµÙˆØ±Øª Ø®Ø±ÛŒØ¯
        
        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù‡Ø¯Ø±ØŒ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ùˆ Ø³Ú©Ù‡
        document.getElementById('headerAvatar').textContent = initial;
        document.getElementById('headerName').textContent = userData.firstName || 'Ú©Ø§Ø±Ø¨Ø±';
        document.getElementById('headerCoins').textContent = userData.coins;
        
        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ú©Ø§Ù…Ù„
        if (document.getElementById('fullAvatar')) {
            document.getElementById('fullAvatar').textContent = initial;
            document.getElementById('fullName').textContent = `${userData.firstName || ''} ${userData.lastName || ''}`;
            document.getElementById('totalCoins').textContent = userData.coins;
            document.getElementById('level').textContent = userData.level;
            document.getElementById('totalQuestions').textContent = userData.totalQuestions;
            document.getElementById('playTime').textContent = userData.playTime;
        }
        
        if (document.getElementById('shopCoins')) document.getElementById('shopCoins').textContent = userData.coins;
        if (document.getElementById('newFirstName')) document.getElementById('newFirstName').value = userData.firstName;
        
        toggleMusicButtonUI();
        updateShopAndLearningStatus();
        displayNotes();
        // displayIdeas(); // Ø§Ú¯Ø± Ù†ÛŒØ§Ø² Ø¯Ø§Ø±ÛŒØ¯ Ø§ÛŒØ¯Ù‡â€ŒÙ‡Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø´ÙˆÙ†Ø¯
    }

    function showScreen(screenId) {
        document.querySelectorAll('.screen').forEach(screen => {
            screen.classList.remove('active');
        });
        const targetScreen = document.getElementById(screenId);
        if (targetScreen) {
            targetScreen.classList.add('active');
        } 
        updateUI();
    }
    
    // ------------------------------------------------------------------
    // 4. Ù…Ø¯ÛŒØ±ÛŒØª Ø±Ù‚Ø§Ø¨Øª (Battle) - ÙÛŒÚ©Ø³ Ø³Ø®ØªÛŒ
    // ------------------------------------------------------------------

    function getCoinReward(difficulty) {
        switch (difficulty) {
            case 'easy': return 3;
            case 'medium': return 5;
            case 'hard': return 7;
            default: return 4;
        }
    }

    function startBattle(subject, difficulty) {
        const questions = quizQuestions[subject][difficulty];
        
        let selectedQuestions = [...questions];
        shuffleArray(selectedQuestions);
        
        currentQuizQuestions = selectedQuestions;
        
        currentQuestionIndex = 0;
        correctAnswersCount = 0;
        
        document.getElementById('totalQCountDisplay').textContent = currentQuizQuestions.length;
        document.getElementById('correctCountDisplay').textContent = correctAnswersCount;
        document.getElementById('currentQIndexDisplay').textContent = currentQuestionIndex + 1;
        
        // Ø°Ø®ÛŒØ±Ù‡ Ø³Ø®ØªÛŒ Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø§Ù…ØªÛŒØ§Ø² Ù†Ù‡Ø§ÛŒÛŒ
        currentQuizQuestions.difficulty = difficulty; 
        
        showScreen('quiz');
        loadQuestion();
    }

    function loadQuestion() {
        if (currentQuestionIndex >= currentQuizQuestions.length) {
            endBattle();
            return;
        }
        
        const q = currentQuizQuestions[currentQuestionIndex];
        document.getElementById('question').innerHTML = `${currentQuestionIndex + 1}. ${q.question}`;
        
        const optionsDiv = document.getElementById('options');
        optionsDiv.innerHTML = '';
        
        let shuffledOptions = [...q.options];
        shuffleArray(shuffledOptions);

        shuffledOptions.forEach(option => {
            const card = document.createElement('div');
            card.className = 'option-card';
            card.innerHTML = option;
            card.onclick = () => checkAnswer(option, q.answer, card);
            optionsDiv.appendChild(card);
        });
        
        document.getElementById('currentQIndexDisplay').textContent = currentQuestionIndex + 1;
    }

    function checkAnswer(selectedOption, correctAnswer, cardElement) {
        document.querySelectorAll('.option-card').forEach(c => c.onclick = null);

        if (selectedOption === correctAnswer) {
            cardElement.classList.add('correct');
            correctAnswersCount++;
        } else {
            cardElement.classList.add('wrong');
            document.querySelectorAll('.option-card').forEach(c => {
                if (c.innerHTML === correctAnswer) { 
                    c.classList.add('correct');
                }
            });
        }
        
        userData.totalQuestions += 1;
        saveUserData();
        
        currentQuestionIndex++;
        
        setTimeout(loadQuestion, 1000); 
    }

    function endBattle() {
        // Ø§Ù…ØªÛŒØ§Ø²Ø¯Ù‡ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø³Ø®ØªÛŒ Ø³ÙˆØ§Ù„Ø§Øª
        const rewardPerCorrect = getCoinReward(currentQuizQuestions.difficulty); 
        const earnedCoins = correctAnswersCount * rewardPerCorrect; 
        userData.coins += earnedCoins;
        
        // Ù…Ù†Ø·Ù‚ Ø³Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø§Ø±ØªÙ‚Ø§Ø¡ Ø³Ø·Ø­
        if (userData.totalQuestions >= 200) userData.level = 2;
        
        alert(`Ø±Ù‚Ø§Ø¨Øª Ù¾Ø§ÛŒØ§Ù† ÛŒØ§ÙØª. Ø´Ù…Ø§ ${correctAnswersCount} Ù¾Ø§Ø³Ø® ØµØ­ÛŒØ­ Ùˆ ${earnedCoins} Ø³Ú©Ù‡ Ø¯Ø±ÛŒØ§ÙØª Ú©Ø±Ø¯ÛŒØ¯!`);
        saveUserData();
        showScreen('dashboard');
    }

    // ------------------------------------------------------------------
    // 5. Ù…Ù†Ø·Ù‚ ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ùˆ Ø¢Ù…ÙˆØ²Ø´â€ŒÙ‡Ø§ÛŒ Ù¾Ù†Ù‡Ø§Ù†
    // ------------------------------------------------------------------
    
    function updateShopAndLearningStatus() {
        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ ÙØ±ÙˆØ´Ú¯Ø§Ù‡
        document.querySelectorAll('#shop .shop-item').forEach(item => {
            const itemId = item.getAttribute('onclick').match(/'([^']+)'/)[1];
            if (userData.purchasedItems[itemId]) {
                item.style.border = '3px solid var(--success)';
                item.style.opacity = '0.7';
                item.querySelector('.price').textContent = 'Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ Ø´Ø¯Ù‡ âœ…';
            } else {
                item.style.border = '2px solid var(--glass-border)';
                item.style.opacity = '1';
            }
        });
        
        // Ù…Ù†Ø·Ù‚ Ù†Ù…Ø§ÛŒØ´/Ù¾Ù†Ù‡Ø§Ù†â€ŒØ³Ø§Ø²ÛŒ Ù…Ø­ØªÙˆØ§ÛŒ Ù…Ø§Ú˜ÙˆÙ„â€ŒÙ‡Ø§ÛŒ Ø¢Ù…ÙˆØ²Ø´ÛŒ
        document.querySelectorAll('#learning .notebook').forEach(notebook => {
            const button = notebook.querySelector('button');
            // Ø§Ø³ØªØ®Ø±Ø§Ø¬ itemId Ø§Ø² onclick
            const match = button.getAttribute('onclick').match(/'([^']+)'/);
            const itemId = match ? match[1] : null; 
            
            if (!itemId) return;

            const contentDiv = notebook.querySelector('.notebook-content');
            const placeholderDiv = notebook.querySelector('.notebook-content-placeholder');

            if (userData.purchasedItems[itemId]) {
                if (contentDiv) contentDiv.classList.add('visible');
                if (placeholderDiv) placeholderDiv.style.display = 'none';
                button.textContent = 'Ù…Ø§Ú˜ÙˆÙ„ ÙØ¹Ø§Ù„ âœ…';
                button.style.background = '#4CAF50';
                button.disabled = true;
            } else {
                if (contentDiv) contentDiv.classList.remove('visible');
                if (placeholderDiv) placeholderDiv.style.display = 'block';
                
                // ØªÙ†Ø¸ÛŒÙ… Ù‚ÛŒÙ…Øª Ø¨Ø± Ø§Ø³Ø§Ø³ itemId (Ø³Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ)
                let price = 0;
                if (itemId === 'ai_usage') price = 300;
                else if (itemId === 'health_first_aid') price = 250;
                else price = 200;
                
                button.textContent = `Ø®Ø±ÛŒØ¯ (${price} Ø³Ú©Ù‡)`;
                button.style.background = 'linear-gradient(to right, #834d9b, #d04ed6)';
                button.disabled = false;
            }
        });
    }

    function buyItem(itemId) {
        const itemPrices = { 'avatar_gold': 300, 'avatar_diamond': 500, 'theme_blue': 100, 'theme_green': 120 };
        const price = itemPrices[itemId];
        
        if (userData.purchasedItems[itemId]) { 
            alert('Ø´Ù…Ø§ Ø§ÛŒÙ† Ø¢ÛŒØªÙ… Ø±Ø§ Ù‚Ø¨Ù„Ø§Ù‹ Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯!'); return; 
        }
        
        if (userData.coins >= price) {
            if (confirm(`Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§ÛŒÙ† Ø¢ÛŒØªÙ… Ø±Ø§ Ø¨Ø§ ${price} Ø³Ú©Ù‡ Ø¨Ø®Ø±ÛŒØ¯ØŸ`)) {
                userData.coins -= price; 
                userData.purchasedItems[itemId] = true;
                if (itemId.startsWith('avatar_')) { userData.avatar = itemId.split('_')[1]; }
                if (itemId.startsWith('theme_')) { userData.theme = itemId.split('_')[1]; }
                alert(`Ø®Ø±ÛŒØ¯ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯!`); saveUserData(); updateUI();
            }
        } else { 
            alert('Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø³Ú©Ù‡ Ø´Ù…Ø§ Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª! Ø´Ù…Ø§ Ø¨Ù‡ ' + (price - userData.coins) + ' Ø³Ú©Ù‡ Ø¯ÛŒÚ¯Ø± Ù†ÛŒØ§Ø² Ø¯Ø§Ø±ÛŒØ¯.'); 
        }
    }
    
    function buyLearningModule(itemId, price) {
        if (userData.purchasedItems[itemId]) { return; } 
        if (userData.coins >= price) {
            userData.coins -= price; 
            userData.purchasedItems[itemId] = true;
            alert('Ù…Ø§Ú˜ÙˆÙ„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ Ø´Ø¯ Ùˆ Ù…Ø­ØªÙˆØ§ ÙØ¹Ø§Ù„ Ø´Ø¯!'); 
            saveUserData(); updateUI();
        } else { 
            alert('Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø³Ú©Ù‡ Ø´Ù…Ø§ Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª!'); 
        }
    }

    // ------------------------------------------------------------------
    // 6. Ø³Ø§ÛŒØ± ØªÙˆØ§Ø¨Ø¹ (Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…ØŒ Ø¯ÙˆØ²ØŒ ÛŒØ§Ø¯Ø¯Ø§Ø´ØªØŒ Ù…ÙˆØ³ÛŒÙ‚ÛŒ)
    // ------------------------------------------------------------------

    function registerUser() {
        const first = document.getElementById('firstName').value.trim();
        const last = document.getElementById('lastName').value.trim();

        if (first.length > 0 && last.length > 0) {
            userData.firstName = first;
            userData.lastName = last;
            saveUserData();
            showScreen('dashboard');
        } else {
            alert('Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.');
        }
    }
    
    function changeName() {
        const first = document.getElementById('newFirstName').value.trim();
        const last = document.getElementById('newLastName').value.trim();

        if (first.length > 0 && last.length > 0) {
            userData.firstName = first;
            userData.lastName = last;
            saveUserData();
            alert('Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.');
            updateUI();
        } else {
            alert('Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.');
        }
    }

    function toggleMusic(forcePlay = false) {
        if (forcePlay) { userData.musicOn = true; } else { userData.musicOn = !userData.musicOn; }
        if (userData.musicOn) { 
            musicPlayer.volume = 0.5;
            musicPlayer.play().catch(e => { 
                console.log("Music play blocked."); 
                userData.musicOn = false; saveUserData();
            }); 
        } else { 
            musicPlayer.pause(); 
        }
        saveUserData(); 
        toggleMusicButtonUI();
    }
    
    function toggleMusicButtonUI() {
        const musicToggle = document.getElementById('musicToggle');
        const playMusicBtn = document.getElementById('playMusicBtn');
        
        if (musicToggle) {
            musicToggle.textContent = userData.musicOn ? 'Ø±ÙˆØ´Ù†' : 'Ø®Ø§Ù…ÙˆØ´';
            musicToggle.classList.toggle('active', userData.musicOn);
        }
        
        const isRegisterScreen = document.getElementById('register').classList.contains('active');
        if (playMusicBtn) {
            playMusicBtn.style.display = (!userData.musicOn && isRegisterScreen) ? 'block' : 'none';
        }
    }
    
    function saveNote() {
        const noteText = document.getElementById('newNote').value;
        if (noteText.trim() === "") { alert("Ù„Ø·ÙØ§Ù‹ Ú†ÛŒØ²ÛŒ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯."); return; }
        userData.notes.unshift({ text: noteText, date: new Date().toLocaleDateString('fa-IR') });
        document.getElementById('newNote').value = ''; 
        saveUserData(); displayNotes(); alert('ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.');
    }
    
    function displayNotes() {
        const notesListDiv = document.getElementById('notesList');
        if (!notesListDiv) return;
        
        if (userData.notes.length === 0) {
             notesListDiv.innerHTML = '<p style="margin:20px 0;opacity:0.6;">Ø´Ù…Ø§ Ù‡Ù†ÙˆØ² ÛŒØ§Ø¯Ø¯Ø§Ø´ØªÛŒ Ø°Ø®ÛŒØ±Ù‡ Ù†Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯.</p>';
             return;
        }

        notesListDiv.innerHTML = userData.notes.map((note, index) => 
            `<div style="background:rgba(255,255,255,0.08);padding:15px;border-radius:15px;margin:10px 0;text-align:right;">
                <p style="font-size:1.1rem; line-height:1.6;">
                    <strong style="color:var(--info);">ØªØ§Ø±ÛŒØ®: ${note.date}</strong><br>
                    ${note.text}
                </p>
            </div>`
        ).join('');
    }
    
    function saveIdea(ideaType) {
        const ideaInput = document.getElementById(`ideaInput${ideaType === 'Ù¾Ø§Ø±Ú©' ? 1 : ideaType === 'Ø®Ø§Ù†Ù‡' ? 2 : 3}`);
        const ideaText = ideaInput ? ideaInput.value : '';
        if (ideaText.trim() === "") { alert("Ù„Ø·ÙØ§Ù‹ Ø§ÛŒØ¯Ù‡â€ŒØ§ÛŒ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯."); return; }
        
        if (!userData.ideas[ideaType]) {
            userData.ideas[ideaType] = [];
        }
        userData.ideas[ideaType].unshift({ text: ideaText, date: new Date().toLocaleDateString('fa-IR') });
        if(ideaInput) ideaInput.value = '';
        
        saveUserData();
        alert(`Ø§ÛŒØ¯Ù‡Ù” Ø´Ù…Ø§ Ø¯Ø± Ù…ÙˆØ±Ø¯ ${ideaType} Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯!`);
    }
    
    // Ù…Ù†Ø·Ù‚ Ø¯ÙˆØ²
    function checkWin() {
        const winPatterns = [ [0, 1, 2], [3, 4, 5], [6, 7, 8], [0, 3, 6], [1, 4, 7], [2, 5, 8], [0, 4, 8], [2, 4, 6] ];
        for (const pattern of winPatterns) {
            const [a, b, c] = pattern;
            if (board[a] && board[a] === board[b] && board[a] === board[c]) {
                isGameOver = true; return board[a];
            }
        }
        if (!board.includes("") && !isGameOver) { isGameOver = true; return "Draw"; }
        return null;
    }

    function makeMove(index) {
        if (isGameOver || board[index] !== "" || currentPlayer === "â­•") return;

        board[index] = currentPlayer;
        TTT_CELLS[index].textContent = currentPlayer;
        
        let winner = checkWin();
        if (winner) {
            alert(winner === "Draw" ? "Ù…Ø³Ø§ÙˆÛŒ Ø´Ø¯!" : `Ø¨Ø§Ø²ÛŒÚ©Ù† ${winner} Ø¨Ø±Ù†Ø¯Ù‡ Ø´Ø¯!`);
            resetTicTacToe();
            return;
        }

        currentPlayer = "â­•";
        setTimeout(robotMove, 800);
    }
    
    function robotMove() {
        if (isGameOver) return;
        
        let emptyCells = board.map((cell, index) => cell === "" ? index : null).filter(val => val !== null);
        
        if (emptyCells.length > 0) {
            const moveIndex = emptyCells[Math.floor(Math.random() * emptyCells.length)];
            
            board[moveIndex] = currentPlayer;
            TTT_CELLS[moveIndex].textContent = currentPlayer;

            let winner = checkWin();
            if (winner) {
                alert(winner === "Draw" ? "Ù…Ø³Ø§ÙˆÛŒ Ø´Ø¯!" : `Ø±Ø¨Ø§Øª ${winner} Ø¨Ø±Ù†Ø¯Ù‡ Ø´Ø¯!`);
                resetTicTacToe();
            } else {
                currentPlayer = "âŒ";
            }
        }
    }

    function resetTicTacToe() {
        board = ["", "", "", "", "", "", "", "", ""];
        currentPlayer = "âŒ";
        isGameOver = false;
        TTT_CELLS.forEach(cell => { cell.textContent = ""; });
    }
    
    function addEmoji(emoji) {
        const emojiDisplay = document.getElementById('emojiDisplay');
        if (emojiDisplay) {
            emojiDisplay.textContent += emoji;
            // Scroll to bottom
            emojiDisplay.scrollTop = emojiDisplay.scrollHeight;
        }
    }

    // ------------------------------------------------------------------
    // 7. Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ùˆ ØªØ§ÛŒÙ…Ø±
    // ------------------------------------------------------------------

    document.addEventListener('DOMContentLoaded', () => {
        if (userData.firstName && userData.lastName) {
            showScreen('dashboard');
        } else {
            showScreen('register');
        }
        
        if (userData.musicOn) { toggleMusic(true); }
        
        // Ø§Ø¹Ù…Ø§Ù„ ÙÙˆÙ†Øª Ø°Ø®ÛŒØ±Ù‡â€ŒØ´Ø¯Ù‡
        root.style.setProperty('font-family', `'${userData.font}', sans-serif`);
        
        updateUI();
        
        // ØªØ§ÛŒÙ…Ø± Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø²Ù…Ø§Ù† Ø¨Ø§Ø²ÛŒ (Ù‡Ø± Ø¯Ù‚ÛŒÙ‚Ù‡)
        setInterval(() => { 
            const activeScreenId = document.querySelector('.active') ? document.querySelector('.active').id : null;
            if (activeScreenId && activeScreenId !== 'register') {
                userData.playTime += 1; 
                saveUserData(); 
                if (document.getElementById('settingsPlayTime')) {
                    document.getElementById('settingsPlayTime').textContent = userData.playTime;
                }
            }
        }, 60000); 
    });
    
  </script>
</body>
        </html>
