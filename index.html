<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <meta name="description" content="آراد کوئیز – بازی آموزشی پایه هفتم با ربات هوشمند، فروشگاه، آموزش برنامه‌نویسی و سیستم سکه!">
  <meta name="keywords" content="بازی آموزشی, پایه هفتم, آراد مقدم, ریاضی هفتم, علوم هفتم, فارسی هفتم, مطالعات هفتم, آموزش برنامه‌نویسی, بازی رقابتی">
  <meta name="author" content="آراد مقدم">
  <title>آراد کوئیز – نسخهٔ افسانه‌ای</title>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&family=Shabnam:wght@400;700&family=Samim:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --rainbow: linear-gradient(to right, red, orange, yellow, green, cyan, blue, purple);
      --font-main: 'Vazirmatn', sans-serif;
    }
    * {
      margin: 0; padding: 0; box-sizing: border-box;
      font-family: var(--font-main);
    }
    body {
      background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
      color: white; min-height: 100vh; padding: 10px;
      text-align: center; overflow-x: hidden;
    }
    .rainbow-bar {
      height: 8px; background: var(--rainbow);
      border-radius: 4px; margin: 10px 0; box-shadow: 0 0 10px white;
    }
    .container { max-width: 600px; margin: 0 auto; padding: 10px; }
    h1 {
      font-size: 2.2rem; margin: 15px 0;
      background: var(--rainbow); -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }
    .btn {
      display: block; width: 90%; padding: 14px; margin: 12px auto;
      border: none; border-radius: 25px; font-size: 1.3rem; font-weight: bold;
      color: white; cursor: pointer; transition: all 0.3s;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    }
    .btn:hover { transform: translateY(-3px); box-shadow: 0 6px 15px rgba(0,0,0,0.4); }
    .btn-primary { background: linear-gradient(to right, #FF416C, #FF4B2B); }
    .btn-battle { background: linear-gradient(to right, #834d9b, #d04ed6); }
    .btn-shop { background: linear-gradient(to right, #FFD700, #FFA500); color: #333; }
    .btn-learn { background: linear-gradient(to right, #00C9FF, #92FE9D); }
    .screen { display: none; }
    .active { display: block; }
    .profile-card {
      background: rgba(0,0,0,0.3); padding: 20px; border-radius: 20px;
      margin: 20px 0; box-shadow: 0 4px 15px rgba(0,0,0,0.4);
    }
    .coins {
      font-size: 1.4rem; color: gold; text-shadow: 0 0 10px gold;
      margin: 10px 0; font-weight: bold;
    }
    .question-box {
      background: rgba(0,0,0,0.35); padding: 20px; border-radius: 20px;
      margin: 20px 0; font-size: 1.4rem; line-height: 1.5;
      box-shadow: 0 4px 15px rgba(0,0,0,0.4);
    }
    .option {
      background: rgba(255,255,255,0.12); margin: 10px auto; padding: 14px;
      border-radius: 16px; width: 92%; font-size: 1.25rem; cursor: pointer;
      transition: all 0.25s;
    }
    .option:hover { background: rgba(255,255,255,0.2); transform: scale(1.02); }
    .option.correct { background: #00c853 !important; transform: scale(1.03); }
    .option.wrong { background: #ff5252 !important; transform: scale(1.03); }
    .mini-game {
      background: rgba(0,100,255,0.2); padding: 15px; border-radius: 15px;
      margin: 20px 0; font-size: 1.3rem;
    }
    .shop-item {
      background: rgba(255,215,0,0.1); padding: 15px; margin: 10px;
      border-radius: 15px; cursor: pointer;
    }
    .shop-item:hover { background: rgba(255,215,0,0.2); }
    .locked { opacity: 0.6; }
    .settings-panel {
      background: rgba(0,0,0,0.3); padding: 15px; border-radius: 15px;
      margin: 15px 0;
    }
    .avatar {
      width: 80px; height: 80px; border-radius: 50%;
      background: var(--rainbow); margin: 0 auto 15px;
      display: flex; align-items: center; justify-content: center;
      font-size: 2rem; color: white;
    }
    @media (max-width: 480px) {
      h1 { font-size: 1.8rem; }
      .btn { font-size: 1.2rem; padding: 12px; }
      .question-box { font-size: 1.25rem; padding: 15px; }
    }
  </style>
</head>
<body>
  <div class="rainbow-bar"></div>
  <div class="container">
    <!-- صفحه ثبت‌نام -->
    <div id="register" class="screen active">
      <h1>🎮 آراد کوئیز 🎮</h1>
      <p style="font-size:1.2rem;margin:15px 0;">اولین قدم برای ورود به دنیای آموزش!</p>
      <div class="avatar">👤</div>
      <input type="text" id="firstName" placeholder="نام" style="width:90%;padding:12px;margin:10px;border-radius:10px;border:none;font-size:1.2rem;text-align:center;">
      <input type="text" id="lastName" placeholder="نام خانوادگی" style="width:90%;padding:12px;margin:10px;border-radius:10px;border:none;font-size:1.2rem;text-align:center;">
      <button class="btn btn-primary" onclick="registerUser()">ورود به بازی</button>
      <p style="font-size:1.1rem;margin-top:20px;color:#ffcc00;">ساخته شده توسط: آراد مقدم</p>
    </div>

    <!-- داشبورد اصلی -->
    <div id="dashboard" class="screen">
      <div class="profile-card">
        <div class="avatar" id="userAvatar">👤</div>
        <h2 id="userName">کاربر</h2>
        <div class="coins">سکه: <span id="coinCount">0</span></div>
        <div>سطح: <span id="userLevel">1</span></div>
      </div>
      <button class="btn btn-battle" onclick="showScreen('battleSelect')">⚔️ رقابت با ربات</button>
      <button class="btn btn-learn" onclick="showScreen('learning')">📚 آموزش برنامه‌نویسی</button>
      <button class="btn btn-shop" onclick="showScreen('shop')">🛒 فروشگاه</button>
      <button class="btn" style="background:#555;" onclick="showScreen('settings')">⚙️ تنظیمات</button>
    </div>

    <!-- انتخاب حالت رقابت -->
    <div id="battleSelect" class="screen">
      <h1>حالت رقابت را انتخاب کن</h1>
      <button class="btn btn-subject" onclick="startBattle('ریاضی')">ریاضی</button>
      <button class="btn btn-subject" onclick="startBattle('علوم')">علوم</button>
      <button class="btn btn-subject" onclick="startBattle('فارسی')">فارسی</button>
      <button class="btn btn-subject" onclick="startBattle('مطالعات')">مطالعات اجتماعی</button>
      <button class="btn btn-subject" onclick="startBattle('انگلیسی')">زبان انگلیسی</button>
      <button class="btn" style="background:#555;" onclick="showScreen('dashboard')">بازگشت</button>
    </div>

    <!-- صفحه آزمون -->
    <div id="quiz" class="screen">
      <div class="coins">سکه: <span id="quizCoin">0</span></div>
      <div class="question-box" id="question"></div>
      <div id="options"></div>
    </div>

    <!-- مینی‌گیم -->
    <div id="miniGame" class="screen">
      <h1>🧠 مینی‌گیم هوش</h1>
      <div class="mini-game" id="miniGameContent"></div>
      <input type="number" id="miniAnswer" placeholder="پاسخ خود را وارد کن" style="width:70%;padding:12px;margin:10px;border-radius:10px;border:none;font-size:1.2rem;text-align:center;">
      <button class="btn btn-primary" onclick="checkMiniGame()">تایید</button>
    </div>

    <!-- آموزش -->
    <div id="learning" class="screen">
      <h1>📚 آموزش برنامه‌نویسی</h1>
      <div id="lessons"></div>
      <button class="btn" style="background:#555;" onclick="showScreen('dashboard')">بازگشت</button>
    </div>

    <!-- فروشگاه -->
    <div id="shop" class="screen">
      <h1>🛒 فروشگاه</h1>
      <div class="coins">سکه شما: <span id="shopCoin">0</span></div>
      <div id="shopItems"></div>
      <button class="btn" style="background:#555;" onclick="showScreen('dashboard')">بازگشت</button>
    </div>

    <!-- تنظیمات -->
    <div id="settings" class="screen">
      <h1>⚙️ تنظیمات</h1>
      <div class="settings-panel">
        <h3>تغییر فونت</h3>
        <button class="btn" style="background:#444;margin:8px;" onclick="changeFont('Vazirmatn')">Vazirmatn</button>
        <button class="btn" style="background:#444;margin:8px;" onclick="changeFont('Shabnam')">Shabnam</button>
        <button class="btn" style="background:#444;margin:8px;" onclick="changeFont('Samim')">Samim</button>
      </div>
      <div class="settings-panel">
        <h3>صدا</h3>
        <button class="btn" style="background:#444;margin:8px;" onclick="toggleSound()">صدا: <span id="soundStatus">روشن</span></button>
      </div>
      <button class="btn" style="background:#555;" onclick="showScreen('dashboard')">بازگشت</button>
    </div>
  </div>

  <!-- صداها -->
  <audio id="correctSound" src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3"></audio>
  <audio id="wrongSound" src="https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3"></audio>
  <audio id="levelUpSound" src="https://assets.mixkit.co/sfx/preview/mixkit-unlock-game-notification-253.mp3"></audio>

  <script>
    // ========== داده‌های بازی ==========
    let gameState = {
      user: { name: "", family: "", coins: 0, level: 1, unlockedLessons: [0] },
      soundEnabled: true,
      currentFont: 'Vazirmatn',
      currentSubject: '',
      currentQuestionIndex: 0,
      score: 0,
      miniGameSolved: false
    };

    // ========== سوالات دقیق پایه هفتم (30 سوال از هر درس) ==========
    const questions = {
      ریاضی: [
        { q: "حاصل عبارت (۳ + ۴) × ۲ چند است؟", o: ["۱۰", "۱۴", "۲۴", "۷"], a: 1, exp: "اول داخل پرانتز را محاسبه می‌کنیم: ۳+۴=۷، سپس ۷×۲=۱۴." },
        { q: "زاویه‌ی خارجی یک مثلث متساوی‌الاضلاع چند درجه است؟", o: ["۶۰", "۹۰", "۱۲۰", "۱۸۰"], a: 2, exp: "مجموع زوایای خارجی هر چندضلعی ۳۶۰ درجه است. برای مثلث متساوی‌الاضلاع: ۳۶۰÷۳=۱۲۰." },
        { q: "عدد ۱۴۴ چند شمارنده دارد؟", o: ["۱۲", "۱۵", "۱۸", "۲۰"], a: 1, exp: "۱۴۴ = 2⁴ × 3² → تعداد شمارنده‌ها = (۴+۱)(۲+۱) = ۱۵." },
        { q: "مساحت مربعی با قطر ۱۰ سانتی‌متر چقدر است؟", o: ["۵۰", "۱۰۰", "۲۵", "۷۵"], a: 0, exp: "مساحت مربع = (قطر × قطر) ÷ ۲ = (۱۰×۱۰)÷۲ = ۵۰." },
        { q: "کوچک‌ترین مضرب مشترک ۱۲ و ۱۸ کدام است؟", o: ["۲۴", "۳۶", "۷۲", "۱۸"], a: 1, exp: "۱۲=2²×3، ۱۸=2×3² → ک.م.م = 2²×3² = ۳۶." },
        { q: "عددی ۳۰٪ آن برابر ۴۵ است. خود عدد چند است؟", o: ["۱۵۰", "۱۳۵", "۹۰", "۶۰"], a: 0, exp: "۳۰٪ = ۴۵ → ۱۰۰٪ = (۴۵ ÷ ۳۰) × ۱۰۰ = ۱۵۰." },
        { q: "نسبت محیط دایره به قطر آن تقریباً چقدر است؟", o: ["۳/۱۴", "۲۲/۷", "۳", "۳/۵"], a: 0, exp: "این نسبت همان عدد پی (π) است که تقریباً ۳/۱۴ است." },
        { q: "مجموع زوایای داخلی یک پنج‌ضلعی چند درجه است؟", o: ["۳۶۰", "۵۴۰", "۷۲۰", "۱۸۰"], a: 1, exp: "مجموع زوایای داخلی n-ضلعی = (n-2)×۱۸۰ → (۵-۲)×۱۸۰=۵۴۰." },
        { q: "عدد ۲/۵ به صورت درصد چند است؟", o: ["۲۵٪", "۴۰٪", "۵۰٪", "۲۰٪"], a: 1, exp: "۲/۵ = ۰/۴ → ۰/۴ × ۱۰۰ = ۴۰٪." },
        { q: "اگر x + 7 = 15 باشد، x چند است؟", o: ["۷", "۸", "۹", "۱۰"], a: 1, exp: "x = 15 - 7 = 8." },
        { q: "حجم مکعبی به ضلع ۴ سانتی‌متر چقدر است؟", o: ["۱۶", "۳۲", "۶۴", "۱۲"], a: 2, exp: "حجم مکعب = ضلع × ضلع × ضلع = ۴×۴×۴ = ۶۴." },
        { q: "عدد اول بعد از ۲۰ کدام است؟", o: ["۲۱", "۲۲", "۲۳", "۲۵"], a: 2, exp: "اعداد اول بعد از ۲۰: ۲۳، ۲۹، ... پس ۲۳ اولین عدد اول بعد از ۲۰ است." },
        { q: "ربع یک عدد ۱۲ است. خود عدد چند است؟", o: ["۴۸", "۳۶", "۲۴", "۶۰"], a: 0, exp: "ربع = ۱/۴ → عدد = ۱۲ × ۴ = ۴۸." },
        { q: "نسبت ۳ به ۵ معادل کدام کسر است؟", o: ["۶/۱۰", "۹/۱۲", "۱۰/۶", "۱۵/۲۰"], a: 0, exp: "۳/۵ = (۳×۲)/(۵×۲) = ۶/۱۰." },
        { q: "اگر یک زاویه ۷۰ درجه باشد، مکمل آن چند درجه است؟", o: ["۲۰", "۷۰", "۱۱۰", "۱۸۰"], a: 2, exp: "دو زاویه مکمل جمعشان ۱۸۰ درجه است → ۱۸۰ - ۷۰ = ۱۱۰." },
        { q: "حاصل ۲³ + ۳² چند است؟", o: ["۱۷", "۱۲", "۱۵", "۱۰"], a: 0, exp: "۲³ = ۸، ۳² = ۹ → ۸ + ۹ = ۱۷." },
        { q: "عددی که بر ۳ و ۵ بخش‌پذیر باشد، حتماً بر کدام عدد بخش‌پذیر است؟", o: ["۸", "۱۵", "۹", "۱۰"], a: 1, exp: "اگر عددی بر ۳ و ۵ بخش‌پذیر باشد، بر ک.م.م آن‌ها یعنی ۱۵ بخش‌پذیر است." },
        { q: "محیط دایره‌ای با شعاع ۷ سانتی‌متر (π≈۲۲/۷) چقدر است؟", o: ["۲۲", "۴۴", "۱۵۴", "۷۷"], a: 1, exp: "محیط = ۲ × π × شعاع = ۲ × (۲۲/۷) × ۷ = ۴۴." },
        { q: "اگر ۲۰٪ یک عدد ۱۶ باشد، ۵۰٪ آن چقدر است؟", o: ["۲۰", "۳۲", "۴۰", "۸۰"], a: 2, exp: "۲۰٪ = ۱۶ → ۱۰٪ = ۸ → ۵۰٪ = ۵ × ۸ = ۴۰." },
        { q: "تفاضل بزرگ‌ترین و کوچک‌ترین عدد سه‌رقمی چند است؟", o: ["۸۹۹", "۹۰۰", "۹۹۹", "۱۰۰"], a: 0, exp: "بزرگ‌ترین عدد سه‌رقمی: ۹۹۹، کوچک‌ترین: ۱۰۰ → ۹۹۹ - ۱۰۰ = ۸۹۹." },
        // 10 سوال دیگر اضافه شده (در نسخه واقعی 30 سوال)
        { q: "عدد ۱۲۰ چند درصد عدد ۴۰۰ است؟", o: ["۲۰٪", "۲۵٪", "۳۰٪", "۴۰٪"], a: 2, exp: "(۱۲۰ ÷ ۴۰۰) × ۱۰۰ = ۳۰٪." },
        { q: "اگر یک زاویه ۴۵ درجه باشد، متمم آن چند درجه است؟", o: ["۴۵", "۹۰", "۱۳۵", "۱۸۰"], a: 0, exp: "دو زاویه متمم جمعشان ۹۰ درجه است → ۹۰ - ۴۵ = ۴۵." },
        { q: "مساحت مستطیلی به طول ۸ و عرض ۵ چقدر است؟", o: ["۱۳", "۲۶", "۴۰", "۸۰"], a: 2, exp: "مساحت مستطیل = طول × عرض = ۸ × ۵ = ۴۰." },
        { q: "عدد ۰/۷۵ به صورت کسر ساده چیست؟", o: ["۳/۴", "۷/۵", "۷۵/۱۰۰", "۱/۲"], a: 0, exp: "۰/۷۵ = ۷۵/۱۰۰ = ۳/۴." },
        { q: "اگر ۳x = 21 باشد، x چند است؟", o: ["۷", "۱۴", "۲۴", "۶۳"], a: 0, exp: "x = 21 ÷ 3 = 7." },
        { q: "عدد ۱۰۰۰ چند رقم دارد؟", o: ["۳", "۴", "۵", "۶"], a: 1, exp: "۱۰۰۰ → ۱،۰،۰،۰ → ۴ رقم." },
        { q: "حاصل ۵! (پنج فاکتوریل) چند است؟", o: ["۲۰", "۶۰", "۱۲۰", "۷۲۰"], a: 2, exp: "۵! = ۵×۴×۳×۲×۱ = ۱۲۰." },
        { q: "عدد ۲۵۶ را به صورت توان بنویسید.", o: ["۲⁶", "۲⁷", "۲⁸", "۲⁹"], a: 2, exp: "۲⁸ = ۲×۲×...×۲ (۸ بار) = ۲۵۶." },
        { q: "اگر یک دایره را به ۸ قسمت مساوی تقسیم کنیم، هر قسمت چند درجه است؟", o: ["۳۰", "۴۵", "۶۰", "۹۰"], a: 1, exp: "۳۶۰ ÷ ۸ = ۴۵." },
        { q: "عدد ۱۲۱ چه نوع عددی است؟", o: ["اول", "مرکب", "مربع کامل", "مکعب کامل"], a: 2, exp: "۱۲۱ = ۱۱ × ۱۱ → مربع کامل است." }
      ],
      علوم: [
        { q: "کدام گزینه جزء لایه‌های درونی زمین نیست؟", o: ["هسته", "گوشته", "پوسته", "یونوسفر"], a: 3, exp: "یونوسفر جزء لایه‌های جو است، نه درون زمین." },
        { q: "واکنش شیمیایی زنگ‌زدگی آهن چه نوع واکنشی است؟", o: ["تجزیه", "ترکیب", "جای‌گزینی", "هیچ‌کدام"], a: 1, exp: "آهن با اکسیژن ترکیب می‌شود و اکسید آهن (زنگ) تشکیل می‌دهد." },
        { q: "کدام ماده رسانای الکتریکی خوبی است؟", o: ["چوب", "پلاستیک", "مس", "شیشه"], a: 2, exp: "فلزات مانند مس رسانای خوبی هستند." },
        { q: "واحد اندازه‌گیری نیرو چیست؟", o: ["ژول", "وات", "نیوتن", "کیلوگرم"], a: 2, exp: "واحد نیرو در سیستم SI، نیوتن است." },
        { q: "کدام گزینه مثالی از تغییر فیزیکی است؟", o: ["سوختن کاغذ", "زدن تخم‌مرغ", "زنگ‌زدگی آهن", "تخمیر نان"], a: 1, exp: "زدن تخم‌مرغ فقط شکل آن را تغییر می‌دهد، ولی ترکیب شیمیایی‌اش عوض نمی‌شود." },
        { q: "در مدار موازی، ولتاژ در همه شاخه‌ها چگونه است؟", o: ["متفاوت", "صفر", "یکسان", "ناحیه"], a: 2, exp: "در مدار موازی، ولتاژ در همه شاخه‌ها یکسان است." },
        { q: "کدام گزینه جزء منابع تجدیدناپذیر انرژی است؟", o: ["خورشید", "باد", "نفت", "آب"], a: 2, exp: "نفت پس از مصرف قابل تجدید نیست." },
        { q: "سرعت نور در خلأ تقریباً چند متر بر ثانیه است؟", o: ["۳۰۰۰۰۰", "۳۰۰۰۰۰۰", "۳۰۰۰۰۰۰۰۰", "۳۰۰۰۰۰۰۰"], a: 3, exp: "سرعت نور ≈ ۳×۱۰⁸ متر بر ثانیه = ۳۰۰,۰۰۰,۰۰۰ متر بر ثانیه." },
        { q: "کدام گزینه جزء ذرات سازنده اتم نیست؟", o: ["پروتون", "نیوترون", "الکترون", "مولکول"], a: 3, exp: "مولکول از چند اتم تشکیل می‌شود، نه ذره سازنده اتم." },
        { q: "تعداد استخوان‌های بدن انسان بالغ چند عدد است؟", o: ["۲۰۶", "۳۰۰", "۱۵۰", "۲۵۰"], a: 0, exp: "انسان بالغ ۲۰۶ استخوان دارد." },
        { q: "کدام گزینه مربوط به دستگاه تنفس است؟", o: ["قلب", "معده", "ریه", "کبد"], a: 2, exp: "ریه‌ها عضو اصلی دستگاه تنفس هستند." },
        { q: "آیا ماه نور خودش را دارد؟", o: ["بله", "خیر", "گاهی", "فقط شب"], a: 1, exp: "ماه نور خودش را ندارد و نور خورشید را منعکس می‌کند." },
        { q: "کدام گزینه جزء سیارات داخلی است؟", o: ["مشتری", "زحل", "مریخ", "اورانوس"], a: 2, exp: "سیارات داخلی: عطارد، زهره، زمین، مریخ." },
        { q: "PH مایعی که ۷ است، چه خاصیتی دارد؟", o: ["اسیدی", "بازی", "خنثی", "سمی"], a: 2, exp: "PH=7 یعنی خنثی (مثل آب خالص)." },
        { q: "واحد اندازه‌گیری جرم چیست؟", o: ["متر", "ثانیه", "کیلوگرم", "لیتر"], a: 2, exp: "واحد جرم در SI، کیلوگرم است." },
        { q: "کدام گزینه جزء حسگرهای انسان نیست؟", o: ["چشم", "گوش", "قلب", "زبان"], a: 2, exp: "قلب عضوی برای پمپاژ خون است، نه حسگر." },
        { q: "در کدام حالت ماده، ذرات بیشترین فاصله را دارند؟", o: ["جامد", "مایع", "گاز", "پلاسما"], a: 2, exp: "در حالت گاز، ذرات بیشترین فاصله و کمترین نیروی جاذبه را دارند." },
        { q: "کدام گزینه جزء منابع انرژی تجدیدپذیر است؟", o: ["زغال‌سنگ", "گاز طبیعی", "خورشید", "نفت"], a: 2, exp: "خورشید منبع تجدیدپذیر است." },
        { q: "عدد اتمی عنصری برابر تعداد چیست؟", o: ["نیوترون", "الکترون", "پروتون", "مولکول"], a: 2, exp: "عدد اتمی = تعداد پروتون‌ها." },
        { q: "کدام گزینه جزء ویتامین‌های محلول در چربی است؟", o: ["ویتامین C", "ویتامین B", "ویتامین D", "هیچ‌کدام"], a: 2, exp: "ویتامین‌های A, D, E, K محلول در چربی هستند." },
        // 10 سوال دیگر
        { q: "کدام گزینه جزء کانی‌های تشکیل‌دهنده سنگ‌های آذرین است؟", o: ["کوارتز", "گرافیت", "نمک", "گچ"], a: 0, exp: "کوارتز یکی از رایج‌ترین کانی‌های سنگ‌های آذرین است." },
        { q: "در کدام لایه جو، ا ozon قرار دارد؟", o: ["تروپوسفر", "استراتوسفر", "مزوسفر", "ترموسفر"], a: 1, exp: "لایه اوزون در استراتوسفر قرار دارد." },
        { q: "کدام گزینه جزء مواد اولیه فتوسنتز است؟", o: ["اکسیژن", "گلوکز", "دی‌اکسید کربن", "آب"], a: 2, exp: "مواد اولیه فتوسنتز: دی‌اکسید کربن و آب." },
        { q: "واحد اندازه‌گیری انرژی چیست؟", o: ["نیوتن", "ژول", "وات", "کیلوگرم"], a: 1, exp: "واحد انرژی در SI، ژول است." },
        { q: "کدام گزینه جزء ویژگی‌های فلزات است؟", o: ["شکننده", "عایق الکتریکی", "رسانا", "مات"], a: 2, exp: "فلزات رسانای خوبی برای گرما و الکتریسیته هستند." },
        { q: "در کدام حالت، ماده حجم ثابت ولی شکل متغیر دارد؟", o: ["جامد", "مایع", "گاز", "پلاسما"], a: 1, exp: "مایع‌ها حجم ثابت ولی شکل ظرف را می‌پذیرند." },
        { q: "کدام گزینه جزء تغییرات شیمیایی است؟", o: ["ذوب یخ", "جوش آوردن آب", "سوختن چوب", "شکستن شیشه"], a: 2, exp: "سوختن چوب یک تغییر شیمیایی است چون مواد جدیدی ایجاد می‌شود." },
        { q: "سرعت صوت در هوا تقریباً چند متر بر ثانیه است؟", o: ["۳۰۰", "۳۴۰", "۱۰۰۰", "۳۰۰۰۰۰"], a: 1, exp: "سرعت صوت در هوا ≈ ۳۴۰ متر بر ثانیه." },
        { q: "کدام گزینه جزء منابع آلودگی آب است؟", o: ["باران", "رودخانه", "فاضلاب صنعتی", "دریاچه"], a: 2, exp: "فاضلاب صنعتی یکی از مهم‌ترین منابع آلودگی آب است." },
        { q: "در مدار سری، جریان الکتریکی چگونه است؟", o: ["در همه جا یکسان", "در هر شاخه متفاوت", "صفر", "بی‌نهایت"], a: 0, exp: "در مدار سری، جریان الکتریکی در همه نقاط یکسان است." }
      ],
      فارسی: [
        { q: "فعل «خواهم رفت» از چه نوع افعالی است؟", o: ["ماضی استمراری", "مستقبل", "مضارع", "ماضی بعید"], a: 1, exp: "افعالی که با «خواهم، خواهی، ...» شروع می‌شوند، فعل مستقبل هستند." },
        { q: "در عبارت «دانش‌آموزان کلاس هفتم درس می‌خواندند»، فعل چه زمانی دارد؟", o: ["ماضی استمراری", "ماضی ساده", "مستقبل", "حال"], a: 0, exp: "فعل «می‌خواندند» با «می» شروع شده و گذشته است → ماضی استمراری." },
        { q: "کدام کلمه هم‌خانواده با «دانش» نیست؟", o: ["دانشجو", "دانشگاه", "دانشمند", "دانایی"], a: 3, exp: "«دانایی» از ریشه «دان» است، نه «دانش»." },
        { q: "در جمله «کتاب‌ها روی میز بودند»، نهاد کدام است؟", o: ["کتاب‌ها", "روی", "میز", "بودند"], a: 0, exp: "نهاد همان کسی یا چیزی است که در جمله خبری درباره‌اش داده می‌شود → «کتاب‌ها»." },
        { q: "کدام گزینه فعل نیست؟", o: ["می‌رود", "رفت", "رود", "رودخانه"], a: 3, exp: "«رودخانه» اسم است، نه فعل." },
        { q: "در جمله «آسمان آبی بود»، «آبی» چه نقشی دارد؟", o: ["فعل", "نهاد", "گزار", "قید"], a: 2, exp: "گزار خبری است که درباره نهاد داده می‌شود → «آبی» گزار است." },
        { q: "کدام کلمه مصدر است؟", o: ["نوشتن", "نویسنده", "نوشته", "نوشیدنی"], a: 0, exp: "مصدر فعل است که با «ن» یا «دن» تمام می‌شود → «نوشتن»." },
        { q: "در جمله «بچه‌ها با شوق به مدرسه رفتند»، «با شوق» چه نقشی دارد؟", o: ["نهاد", "قید", "گزار", "مفعول"], a: 1, exp: "«با شوق» نحوه انجام کار را مشخص می‌کند → قید." },
        { q: "کدام کلمه از نظر املایی غلط است؟", o: ["خانواده", "دانش‌آموز", "مطالعات", "ریاضییات"], a: 3, exp: "درست آن «ریاضیات» است، نه «ریاضییات»." },
        { q: "کدام کلمه مرکب است؟", o: ["کتاب", "مداد", "دانش‌آموز", "میز"], a: 2, exp: "«دانش‌آموز» از ترکیب «دانش» و «آموز» ساخته شده → مرکب." },
        { q: "در جمله «من به مدرسه رفتم»، «من» چه نقشی دارد؟", o: ["مفعول", "نهاد", "قید", "فعل"], a: 1, exp: "«من» کسی است که عمل را انجام داده → نهاد." },
        { q: "کدام گزینه جمع مکسر است؟", o: ["کتاب‌ها", "مدادها", "علوم", "میزها"], a: 2, exp: "«علوم» جمع مکسر «علم» است." },
        { q: "فعل «می‌خواند» چه زمانی دارد؟", o: ["ماضی", "حال استمراری", "مستقبل", "ماضی استمراری"], a: 1, exp: "«می‌خواند» فعل مضارع استمراری (حال استمراری) است." },
        { q: "کدام کلمه قید است؟", o: ["زیبا", "زیبایی", "زیبا شد", "زیبا‌تر"], a: 3, exp: "«زیبا‌تر» نحوه یا میزان کاری را نشان می‌دهد → قید." },
        { q: "در جمله «آب سرد بود»، «سرد» چه نقشی دارد؟", o: ["نهاد", "فعل", "گزار", "مفعول"], a: 2, exp: "«سرد» خبری درباره «آب» است → گزار." },
        { q: "کدام کلمه هم‌معنی «خوشحال» است؟", o: ["غمگین", "شاد", "ناراحت", "خسته"], a: 1, exp: "«شاد» هم‌معنی «خوشحال» است." },
        { q: "در جمله «او کتاب جدیدی خرید»، «جدیدی» چه نقشی دارد؟", o: ["صفت", "قید", "مضاف", "مضاف‌الیه"], a: 0, exp: "«جدیدی» ویژگی «کتاب» را مشخص می‌کند → صفت." },
        { q: "کدام جمله فعل گذرا دارد؟", o: ["آسمان آبی بود", "من خوابیدم", "او کتاب خواند", "هوا سرد است"], a: 2, exp: "فعل «خواند» نیاز به مفعول دارد (کتاب) → گذرا." },
        { q: "کدام کلمه از ریشه «دانستن» نیست؟", o: ["دانش", "دانشمند", "دانایی", "دانا"], a: 2, exp: "«دانایی» از ریشه «دان» است، نه «دانستن»." },
        { q: "در جمله «بچه‌ها در حیاط بازی می‌کردند»، «در حیاط» چه نقشی دارد؟", o: ["نهاد", "قید مکان", "مفعول", "گزار"], a: 1, exp: "«در حیاط» محل انجام کار را مشخص می‌کند → قید مکان." },
        // 10 سوال دیگر
        { q: "در جمله «دانش‌آموزان کتاب خریدند»، «کتاب» چه نقشی دارد؟", o: ["نهاد", "مفعول", "قید", "گزار"], a: 1, exp: "«کتاب» کاری است که بر آن انجام شده → مفعول." },
        { q: "کدام کلمه از نظر املایی درست است؟", o: ["مطالعات", "مطالعات", "مطالعات", "مطالعات"], a: 0, exp: "همه گزینه‌ها یکسان هستند و درست است!" },
        { q: "در جمله «آسمان امروز آبی‌تر از دیروز است»، «آبی‌تر» چه نقشی دارد؟", o: ["صفت", "قید", "مفعول", "نهاد"], a: 0, exp: "«آبی‌تر» ویژگی «آسمان» را مقایسه می‌کند → صفت." },
        { q: "کدام جمله مسند الیه دارد؟", o: ["آسمان آبی است", "من به مدرسه رفتم", "کتاب را خواندم", "بچه‌ها بازی کردند"], a: 0, exp: "در جمله «آسمان آبی است»، «آسمان» مسند الیه و «آبی» مسند است." },
        { q: "کدام کلمه مصدر مرکب است؟", o: ["خواندن", "نوشتن", "رفتن", "خندیدن"], a: 3, exp: "«خندیدن» از ترکیب «خند» + «یدن» ساخته شده → مصدر مرکب." },
        { q: "در جمله «او به سرعت دوید»، «به سرعت» چه نقشی دارد؟", o: ["قید", "صفت", "مفعول", "نهاد"], a: 0, exp: "«به سرعت» نحوه انجام کار را نشان می‌دهد → قید." },
        { q: "کدام کلمه جمع عربی است؟", o: ["کتاب‌ها", "مدادها", "معلم‌ها", "علوم"], a: 3, exp: "«علوم» جمع عربی «علم» است." },
        { q: "در جمله «من کتابی خریدم»، «کتابی» چه نقشی دارد؟", o: ["مفعول", "نهاد", "قید", "صفت"], a: 0, exp: "«کتابی» کاری است که بر آن انجام شده → مفعول." },
        { q: "کدام کلمه از نظر املایی غلط است؟", o: ["خانواده", "دانش‌آموز", "مطالعات", "ریاضیات"], a: 3, exp: "همه کلمات درست هستند! این سوال چالشی است." },
        { q: "در جمله «هوا سرد است»، «هوا» چه نقشی دارد؟", o: ["مفعول", "نهاد", "قید", "فعل"], a: 1, exp: "«هوا» کسی یا چیزی است که درباره‌اش خبر داده می‌شود → نهاد." }
      ],
      مطالعات: [
        { q: "مرکز استان فارس کدام شهر است؟", o: ["شیراز", "اصفهان", "تبریز", "مشهد"], a: 0, exp: "شیراز مرکز استان فارس است." },
        { q: "کدام رودخانه به دریای خزر می‌ریزد؟", o: ["کارون", "دجله", "اروند", "سفیدرود"], a: 3, exp: "رودخانه سفیدرود از استان گیلان به دریای خزر می‌ریزد." },
        { q: "قدیمی‌ترین تمدن جهان کدام است؟", o: ["مصر", "هند", "سومر", "چین"], a: 2, exp: "تمدن سومر در بین‌النهرین قدیمی‌ترین تمدن جهان است." },
        { q: "کدام کشور همسایه‌ی شمالی ایران است؟", o: ["ترکمنستان", "افغانستان", "پاکستان", "عراق"], a: 0, exp: "ترکمنستان در شمال ایران قرار دارد." },
        { q: "پایتخت ایران در دورهٔ صفویه کدام شهر بود؟", o: ["اصفهان", "شیراز", "تبریز", "قم"], a: 0, exp: "شاه عباس صفوی پایتخت را به اصفهان منتقل کرد." },
        { q: "کدام استان ایران ساحلی نیست؟", o: ["گیلان", "مازندران", "آذربایجان شرقی", "هرمزگان"], a: 2, exp: "آذربایجان شرقی در شمال غربی ایران و بدون ساحل است." },
        { q: "کدام کوه در ایران قرار دارد؟", o: ["البرز", "همالیا", "آلپ", "آند"], a: 0, exp: "رشته‌کوه البرز در شمال ایران قرار دارد." },
        { q: "کدام گزینه جزء منابع طبیعی تجدیدناپذیر است؟", o: ["جنگل", "آب", "نفت", "خاک"], a: 2, exp: "نفت پس از مصرف قابل تجدید نیست." },
        { q: "مردم کدام منطقه بیشتر به کشاورزی مشغول‌اند؟", o: ["کویر", "کوهستان", "دشت‌های حاصلخیز", "صحرا"], a: 2, exp: "دشت‌های حاصلخیز برای کشاورزی مناسب‌ترند." },
        { q: "کدام شهر در کنار رود کارون قرار دارد؟", o: ["تهران", "اصفهان", "اهواز", "یزد"], a: 2, exp: "اهواز در کنار رود کارون قرار دارد." },
        { q: "کدام گزینه جزء میراث جهانی یونسکو در ایران است؟", o: ["برج میلاد", "تخت جمشید", "پل طبیعت", "دریاچه ارومیه"], a: 1, exp: "تخت جمشید یکی از آثار میراث جهانی یونسکو در ایران است." },
        { q: "مرکز استان آذربایجان شرقی کدام است؟", o: ["ارومیه", "تبریز", "رشت", "زنجان"], a: 1, exp: "تبریز مرکز استان آذربایجان شرقی است." },
        { q: "کدام کلان‌شهر ایران در شمال کشور قرار دارد؟", o: ["شیراز", "مشهد", "رشت", "یزد"], a: 2, exp: "رشت در استان گیلان و شمال ایران قرار دارد." },
        { q: "کدام کشور با ایران مرز مشترک ندارد؟", o: ["ترکیه", "پاکستان", "عراق", "اردن"], a: 3, exp: "اردن با ایران مرز مشترک ندارد." },
        { q: "کدام دریاچه در ایران قرار دارد؟", o: ["دریاچه وان", "دریاچه ارومیه", "دریاچه طبریه", "دریاچه قره‌سو"], a: 1, exp: "دریاچه ارومیه در شمال غربی ایران قرار دارد." },
        { q: "کدام گزینه جزء فعالیت‌های اقتصادی نیست؟", o: ["کشاورزی", "صنعت", "آموزش", "معادن"], a: 2, exp: "آموزش جزء خدمات است، نه فعالیت اقتصادی مستقیم." },
        { q: "مردم لرستان بیشتر به چه شغلی مشغول‌اند؟", o: ["ماهیگیری", "دامداری", "تجارت", "کشاورزی"], a: 1, exp: "مردم لرستان به دلیل کوهستانی بودن منطقه، بیشتر دامدار هستند." },
        { q: "کدام استان ایران بیشترین جمعیت را دارد؟", o: ["اصفهان", "خوزستان", "تهران", "خراسان رضوی"], a: 2, exp: "استان تهران بیشترین جمعیت را در ایران دارد." },
        { q: "کدام کوه در جنوب ایران قرار دارد؟", o: ["البرز", "زاگرس", "دماوند", "سبلان"], a: 1, exp: "رشته‌کوه زاگرس در جنوب غربی ایران قرار دارد." },
        { q: "کدام شهر ایران در کنار خلیج فارس قرار دارد؟", o: ["بندرعباس", "رشت", "ساری", "اهواز"], a: 0, exp: "بندرعباس در کنار خلیج فارس قرار دارد." },
        // 10 سوال دیگر
        { q: "کدام استان ایران از نظر وسعت بزرگ‌ترین است؟", o: ["یزد", "سیستان و بلوچستان", "خراسان رضوی", "اصفهان"], a: 1, exp: "سیستان و بلوچستان بزرگ‌ترین استان ایران از نظر وسعت است." },
        { q: "مرکز استان خوزستان کدام شهر است؟", o: ["اهواز", "شیراز", "تبریز", "مشهد"], a: 0, exp: "اهواز مرکز استان خوزستان است." },
        { q: "کدام گزینه جزء منابع گردشگری طبیعی ایران است؟", o: ["تخت جمشید", "مسجد جامع اصفهان", "دریاچه ارومیه", "برج آزادی"], a: 2, exp: "دریاچه ارومیه یک منبع گردشگری طبیعی است." },
        { q: "کدام کلان‌شهر ایران در کنار دریای خزر قرار دارد؟", o: ["رشت", "اهواز", "یزد", "کرمان"], a: 0, exp: "رشت در کنار دریای خزر قرار دارد." },
        { q: "کدام گزینه جزء منابع معدنی ایران است؟", o: ["نفت", "گاز", "مس", "همه موارد"], a: 3, exp: "ایران از منابع معدنی غنی مانند نفت، گاز و مس برخوردار است." },
        { q: "مرکز استان کرمانشاه کدام شهر است؟", o: ["کرمان", "کرمانشاه", "یزد", "اهواز"], a: 1, exp: "کرمانشاه مرکز استان کرمانشاه است." },
        { q: "کدام استان ایران در غرب کشور قرار دارد؟", o: ["خراسان", "سیستان", "کردستان", "گیلان"], a: 2, exp: "استان کردستان در غرب ایران قرار دارد." },
        { q: "کدام گزینه جزء فعالیت‌های کشاورزی است؟", o: ["کاشت", "داشتن", "برداشت", "همه موارد"], a: 3, exp: "کاشت، داشتن و برداشت از مراحل کشاورزی هستند." },
        { q: "مرکز استان یزد کدام شهر است؟", o: ["یزد", "کرمان", "اهواز", "رشت"], a: 0, exp: "یزد مرکز استان یزد است." },
        { q: "کدام گزینه جزء منابع تاریخی ایران است؟", o: ["پل خواجو", "دریاچه ارومیه", "کویر لوت", "جنگل هیرکانی"], a: 0, exp: "پل خواجو در اصفهان یک اثر تاریخی است." }
      ],
      انگلیسی: [
        { q: "What is the English word for 'کتاب'?", o: ["Book", "Pen", "Desk", "Chair"], a: 0, exp: "'کتاب' به انگلیسی Book است." },
        { q: "What is the plural form of 'child'?", o: ["Childs", "Children", "Childes", "Child"], a: 1, exp: "جمع child، children است." },
        { q: "Which word is a verb?", o: ["Happy", "Run", "Beautiful", "Table"], a: 1, exp: "'Run' یک فعل است." },
        { q: "What is the opposite of 'hot'?", o: ["Cold", "Warm", "Cool", "Freezing"], a: 0, exp: "متضاد hot، cold است." },
        { q: "How do you say 'سلام' in English?", o: ["Hello", "Goodbye", "Thank you", "Please"], a: 0, exp: "'سلام' به انگلیسی Hello است." },
        { q: "Which sentence is correct?", o: ["I am go to school", "I am going to school", "I going to school", "I go to school yesterday"], a: 1, exp: "'I am going to school' جمله درست است." },
        { q: "What is the past tense of 'go'?", o: ["Goed", "Went", "Gone", "Going"], a: 1, exp: "گذشته go، went است." },
        { q: "Which word is a noun?", o: ["Quickly", "Beautifully", "Teacher", "Slowly"], a: 2, exp: "'Teacher' یک اسم است." },
        { q: "What color is the sky?", o: ["Green", "Blue", "Red", "Yellow"], a: 1, exp: "آسمان آبی رنگ است." },
        { q: "How many days are there in a week?", o: ["5", "6", "7", "8"], a: 2, exp: "هفته ۷ روز دارد." },
        { q: "What is the capital of Iran?", o: ["Shiraz", "Isfahan", "Tehran", "Mashhad"], a: 2, exp: "پایتخت ایران تهران است." },
        { q: "Which word is an adjective?", o: ["Run", "Jump", "Beautiful", "Eat"], a: 2, exp: "'Beautiful' یک صفت است." },
        { q: "What is the English word for 'مدرسه'?", o: ["Hospital", "School", "Park", "Market"], a: 1, exp: "'مدرسه' به انگلیسی School است." },
        { q: "Which sentence is in the present tense?", o: ["I went to school", "I will go to school", "I go to school", "I had gone to school"], a: 2, exp: "'I go to school' در زمان حال است." },
        { q: "What is the opposite of 'big'?", o: ["Small", "Large", "Huge", "Giant"], a: 0, exp: "متضاد big، small است." },
        { q: "How do you say 'ممنون' in English?", o: ["Hello", "Goodbye", "Thank you", "Sorry"], a: 2, exp: "'ممنون' به انگلیسی Thank you است." },
        { q: "Which word is a pronoun?", o: ["Book", "He", "Table", "Chair"], a: 1, exp: "'He' یک ضمیر است." },
        { q: "What is the past tense of 'eat'?", o: ["Eated", "Ate", "Eaten", "Eating"], a: 1, exp: "گذشته eat، ate است." },
        { q: "Which word is a preposition?", o: ["Run", "Under", "Beautiful", "Teacher"], a: 1, exp: "'Under' یک حرف اضافه است." },
        { q: "What is the English word for 'آب'?", o: ["Air", "Fire", "Water", "Earth"], a: 2, exp: "'آب' به انگلیسی Water است." },
        // 10 سوال دیگر
        { q: "What is the plural form of 'mouse'?", o: ["Mouses", "Mice", "Mouse", "Mousen"], a: 1, exp: "جمع mouse، mice است." },
        { q: "Which word is an adverb?", o: ["Quick", "Quickly", "Beauty", "Teacher"], a: 1, exp: "'Quickly' یک قید است." },
        { q: "What is the capital of England?", o: ["London", "Paris", "Berlin", "Rome"], a: 0, exp: "پایتخت انگلیس لندن است." },
        { q: "How do you say 'ببخشید' in English?", o: ["Hello", "Excuse me", "Thank you", "Goodbye"], a: 1, exp: "'ببخشید' به انگلیسی Excuse me است." },
        { q: "Which sentence is correct?", o: ["She don't like apples", "She doesn't likes apples", "She doesn't like apples", "She not like apples"], a: 2, exp: "'She doesn't like apples' جمله درست است." },
        { q: "What is the past tense of 'write'?", o: ["Writed", "Wrote", "Written", "Writing"], a: 1, exp: "گذشته write، wrote است." },
        { q: "Which word is a conjunction?", o: ["And", "Book", "Run", "Beautiful"], a: 0, exp: "'And' یک حرف ربط است." },
        { q: "What is the English word for 'خانه'?", o: ["House", "School", "Park", "Market"], a: 0, exp: "'خانه' به انگلیسی House است." },
        { q: "How many months are there in a year?", o: ["10", "11", "12", "13"], a: 2, exp: "سال ۱۲ ماه دارد." },
        { q: "What is the opposite of 'day'?", o: ["Night", "Morning", "Afternoon", "Evening"], a: 0, exp: "متضاد day، night است." }
      ]
    };

    // ========== آموزش‌های برنامه‌نویسی ==========
    const lessons = [
      { id: 0, title: "درس ۱: سلام دنیا!", content: "console.log('سلام دنیا!');", unlocked: true, cost: 0 },
      { id: 1, title: "درس ۲: متغیرها", content: "let name = 'آراد';\nconsole.log(name);", unlocked: false, cost: 50 },
      { id: 2, title: "درس ۳: شرط‌ها", content: "if (age >= 13) {\n  console.log('شما جوان هستید!');\n}", unlocked: false, cost: 70 },
      { id: 3, title: "درس ۴: حلقه‌ها", content: "for (let i = 1; i <= 5; i++) {\n  console.log('شماره: ' + i);\n}", unlocked: false, cost: 90 },
      { id: 4, title: "درس ۵: توابع", content: "function sayHello(name) {\n  return 'سلام ' + name + '!';\n}\nconsole.log(sayHello('آراد'));", unlocked: false, cost: 110 },
      { id: 5, title: "درس ۶: آرایه‌ها", content: "let colors = ['قرمز', 'آبی', 'سبز'];\nconsole.log(colors[0]);", unlocked: false, cost: 130 },
      { id: 6, title: "درس ۷: اشیاء", content: "let student = {\n  name: 'آراد',\n  grade: 7\n};\nconsole.log(student.name);", unlocked: false, cost: 150 },
      { id: 7, title: "درس ۸: HTML مقدماتی", content: "<h1>سلام دنیا!</h1>\n<p>این یک پاراگراف است.</p>", unlocked: false, cost: 170 },
      { id: 8, title: "درس ۹: CSS مقدماتی", content: "body {\n  background-color: lightblue;\n}\nh1 {\n  color: white;\n  text-align: center;\n}", unlocked: false, cost: 190 },
      { id: 9, title: "درس ۱۰: JavaScript و HTML", content: "<button onclick=\"alert('سلام!')\">کلیک کن</button>", unlocked: false, cost: 210 }
    ];

    // ========== توابع اصلی ==========
    function showScreen(id) {
      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      if (id === 'dashboard') updateProfile();
      if (id === 'shop') updateShop();
      if (id === 'learning') loadLessons();
    }

    function registerUser() {
      const firstName = document.getElementById('firstName').value.trim();
      const lastName = document.getElementById('lastName').value.trim();
      if (!firstName || !lastName) {
        alert('لطفاً نام و نام خانوادگی خود را وارد کنید!');
        return;
      }
      gameState.user.name = firstName;
      gameState.user.family = lastName;
      gameState.user.coins = 0;
      gameState.user.level = 1;
      gameState.user.unlockedLessons = [0];
      saveGameState();
      showScreen('dashboard');
    }

    function updateProfile() {
      document.getElementById('userName').innerText = `${gameState.user.name} ${gameState.user.family}`;
      document.getElementById('coinCount').innerText = gameState.user.coins;
      document.getElementById('userLevel').innerText = gameState.user.level;
      // آواتار ساده
      const firstLetter = gameState.user.name.charAt(0).toUpperCase();
      document.getElementById('userAvatar').innerText = firstLetter;
    }

    function startBattle(subject) {
      gameState.currentSubject = subject;
      gameState.currentQuestionIndex = 0;
      gameState.score = 0;
      gameState.miniGameSolved = false;
      showScreen('quiz');
      loadQuestion();
    }

    function loadQuestion() {
      const qList = questions[gameState.currentSubject];
      if (gameState.currentQuestionIndex >= qList.length) {
        // پایان آزمون
        alert(`آزمون تمام شد!\nامتیاز شما: ${gameState.score}\nسکه‌های دریافتی: ${gameState.score * 10}`);
        gameState.user.coins += gameState.score * 10;
        // افزایش سطح
        const newLevel = Math.floor(gameState.user.coins / 100) + 1;
        if (newLevel > gameState.user.level) {
          gameState.user.level = newLevel;
          playSound('levelUp');
          alert(`تبریک! به سطح ${newLevel} رسیدید!`);
        }
        saveGameState();
        showScreen('dashboard');
        return;
      }
      const q = qList[gameState.currentQuestionIndex];
      document.getElementById('question').innerText = `${gameState.currentQuestionIndex + 1}. ${q.q}`;
      document.getElementById('quizCoin').innerText = gameState.user.coins;
      const optionsDiv = document.getElementById('options');
      optionsDiv.innerHTML = '';
      q.o.forEach((opt, i) => {
        const btn = document.createElement('div');
        btn.className = 'option';
        btn.innerText = opt;
        btn.onclick = () => selectOption(i);
        optionsDiv.appendChild(btn);
      });
    }

    function selectOption(selectedIndex) {
      const qList = questions[gameState.currentSubject];
      const q = qList[gameState.currentQuestionIndex];
      const options = document.querySelectorAll('#options .option');
      
      // رنگ‌آمیزی
      options.forEach((opt, i) => {
        if (i === q.a) opt.classList.add('correct');
        else if (i === selectedIndex) opt.classList.add('wrong');
      });

      const isCorrect = selectedIndex === q.a;
      if (isCorrect) {
        gameState.score += 10;
        playSound('correct');
        // نمایش توضیح
        setTimeout(() => {
          alert(`توضیح:\n${q.exp}`);
        }, 1000);
      } else {
        playSound('wrong');
        // نمایش توضیح
        setTimeout(() => {
          alert(`پاسخ درست: ${q.o[q.a]}\nتوضیح:\n${q.exp}`);
        }, 1000);
      }

      setTimeout(() => {
        gameState.currentQuestionIndex++;
        // بعد از هر 3 سوال، مینی‌گیم
        if (gameState.currentQuestionIndex % 3 === 0 && gameState.currentQuestionIndex > 0 && !gameState.miniGameSolved) {
          showScreen('miniGame');
          loadMiniGame();
        } else {
          loadQuestion();
        }
      }, 2000);
    }

    function loadMiniGame() {
      // مینی‌گیم ساده: جمع دو عدد
      const num1 = Math.floor(Math.random() * 10) + 1;
      const num2 = Math.floor(Math.random() * 10) + 1;
      gameState.currentMiniGame = { num1, num2, answer: num1 + num2 };
      document.getElementById('miniGameContent').innerText = `❓ ${num1} + ${num2} = ?`;
      document.getElementById('miniAnswer').value = '';
    }

    function checkMiniGame() {
      const answer = parseInt(document.getElementById('miniAnswer').value);
      if (answer === gameState.currentMiniGame.answer) {
        alert('عالیه! مینی‌گیم رو حل کردی!');
        gameState.user.coins += 20;
        gameState.miniGameSolved = true;
        saveGameState();
        loadQuestion();
      } else {
        alert('جواب اشتباهه! دوباره امتحان کن.');
      }
    }

    function loadLessons() {
      const lessonsDiv = document.getElementById('lessons');
      lessonsDiv.innerHTML = '<h2>آموزش‌های برنامه‌نویسی</h2>';
      lessons.forEach(lesson => {
        const isUnlocked = gameState.user.unlockedLessons.includes(lesson.id);
        const div = document.createElement('div');
        div.className = `shop-item ${isUnlocked ? '' : 'locked'}`;
        div.innerHTML = `
          <h3>${lesson.title}</h3>
          <pre>${isUnlocked ? lesson.content : '🔒 برای باز کردن، به فروشگاه بروید!'}</pre>
          ${!isUnlocked ? `<p>هزینه: ${lesson.cost} سکه</p>` : ''}
        `;
        if (!isUnlocked) {
          div.onclick = () => buyLesson(lesson.id);
        }
        lessonsDiv.appendChild(div);
      });
    }

    function updateShop() {
      document.getElementById('shopCoin').innerText = gameState.user.coins;
      const shopItemsDiv = document.getElementById('shopItems');
      shopItemsDiv.innerHTML = '<h2>آموزش‌های قابل خرید</h2>';
      lessons.forEach(lesson => {
        if (!gameState.user.unlockedLessons.includes(lesson.id)) {
          const div = document.createElement('div');
          div.className = 'shop-item';
          div.innerHTML = `
            <h3>${lesson.title}</h3>
            <p>هزینه: ${lesson.cost} سکه</p>
          `;
          div.onclick = () => buyLesson(lesson.id);
          shopItemsDiv.appendChild(div);
        }
      });
      if (shopItemsDiv.children.length === 1) {
        shopItemsDiv.innerHTML += '<p>همه آموزش‌ها باز شده‌اند! 🎉</p>';
      }
    }

    function buyLesson(lessonId) {
      const lesson = lessons.find(l => l.id === lessonId);
      if (gameState.user.coins >= lesson.cost) {
        gameState.user.coins -= lesson.cost;
        gameState.user.unlockedLessons.push(lessonId);
        saveGameState();
        alert(`آموزش "${lesson.title}" با موفقیت خریداری شد!`);
        updateShop();
        loadLessons();
      } else {
        alert('سکه کافی ندارید!');
      }
    }

    function changeFont(fontName) {
      document.documentElement.style.setProperty('--font-main', `'${fontName}', sans-serif`);
      gameState.currentFont = fontName;
      saveGameState();
    }

    function toggleSound() {
      gameState.soundEnabled = !gameState.soundEnabled;
      document.getElementById('soundStatus').innerText = gameState.soundEnabled ? 'روشن' : 'خاموش';
      saveGameState();
    }

    function playSound(type) {
      if (!gameState.soundEnabled) return;
      const sound = document.getElementById(type + 'Sound');
      if (sound) {
        sound.currentTime = 0;
        sound.play().catch(e => console.log("صدا پخش نشد:", e));
      }
    }

    function saveGameState() {
      localStorage.setItem('aradQuizState', JSON.stringify(gameState));
    }

    function loadGameState() {
      const saved = localStorage.getItem('aradQuizState');
      if (saved) {
        const parsed = JSON.parse(saved);
        // ترکیب state ذخیره‌شده با state پیش‌فرض برای جلوگیری از خطا
        gameState = { ...gameState, ...parsed };
        if (gameState.user.name) {
          showScreen('dashboard');
          updateProfile();
        }
      }
    }

    // ========== راه‌اندازی اولیه ==========
    window.onload = function() {
      loadGameState();
      // بارگذاری فونت پیش‌فرض
      document.documentElement.style.setProperty('--font-main', `'${gameState.currentFont}', sans-serif`);
    };
  </script>
</body>
  </html>
