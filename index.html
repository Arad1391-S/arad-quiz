<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <meta name="description" content="آراد کوئیز – نسخه ۳.۵: بازی آموزشی پایه هفتم با ۵۰۰ سوال دسته‌بندی شده (آسان، متوسط، سخت)، ماژول‌های پنهان آموزشی و رابط کاربری ابرغول.">
  <meta name="keywords" content="بازی آموزشی, پایه هفتم, آراد مقدم, ریاضی هفتم, علوم هفتم, آموزش هوش مصنوعی, فوریت‌های بهداشتی, بازی رقابتی">
  <meta name="author" content="آراد مقدم">
  <title>آراد کوئیز – نسخهٔ ابرغول ۳.۵</title>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&family=Shabnam:wght@400;700&family=Samim:wght@400;700&display=swap" rel="stylesheet">
  <style>
    /* ------------------------------------------------------------------ */
    /* CSS Variables & Base Styles (بازگشت به نسخه ۳ اصلی) */
    /* ------------------------------------------------------------------ */
    :root {
      --primary: #6A11CB;
      --secondary: #2575FC;
      --success: #00C853;
      --danger: #FF5252;
      --warning: #FFD700;
      --info: #2196F3;
      --light: #f8f9fa;
      --dark: #212529;
      --glass: rgba(255, 255, 255, 0.1);
      --glass-border: rgba(255, 255, 255, 0.2);
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
      color: white; min-height: 100vh; padding: 0;
      text-align: center; overflow-x: hidden;
      font-family: 'Shabnam', sans-serif; /* بازگشت به فونت اصلی ۳.۰ */
    }
    
    /* ------------------------------------------------------------------ */
    /* Mobile/UI Optimization (بهبود تجربه موبایلی با CSS) */
    /* ------------------------------------------------------------------ */
    .header { 
        padding: 10px; position: sticky; top: 0; z-index: 10;
        background: rgba(0, 0, 0, 0.3); box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        display: flex; justify-content: space-between; align-items: center;
    }
    .container { padding: 10px; max-width: 600px; margin: 0 auto; }
    h1 { 
        font-size: 2.2rem; margin: 15px 0;
        background: linear-gradient(to right, #ff9a9e, #fad0c4, #fbc2eb, #a6c1ee);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        text-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    .btn { 
        width: 95%; padding: 16px; margin: 12px auto; font-size: 1.3rem; 
        border-radius: 25px; box-shadow: 0 6px 20px rgba(0,0,0,0.4);
    }
    .input-field {
      width: 95%; padding: 14px; margin: 10px; border-radius: 18px; 
      font-size: 1.2rem; background: rgba(255,255,255,0.12); color: white;
      border: 1px solid var(--glass-border); 
      text-align: center;
    }
    .welcome-text {
      font-size: 1.2rem; line-height: 1.8; margin: 20px 0; padding: 20px;
      background: rgba(0,0,0,0.2); border-radius: 20px; border-left: 4px solid var(--warning);
    }
    
    /* ------------------------------------------------------------------ */
    /* Quiz & Battle Specific Styles (جدید برای دسته‌بندی سختی) */
    /* ------------------------------------------------------------------ */
    .level-select {
        display: grid; grid-template-columns: repeat(3, 1fr);
        gap: 10px; margin: 20px 0;
    }
    .level-btn {
        padding: 15px 5px; border-radius: 15px;
        font-size: 1rem; font-weight: bold;
        cursor: pointer; transition: transform 0.2s;
        border: 2px solid transparent;
        color: white;
        box-shadow: 0 4px 10px rgba(0,0,0,0.4);
    }
    .level-btn.easy { background: linear-gradient(to right, #4CAF50, #8BC34A); }
    .level-btn.medium { background: linear-gradient(to right, #FF9800, #FFC107); }
    .level-btn.hard { background: linear-gradient(to right, #F44336, #E91E63); }
    
    .question-box {
        background: rgba(0,0,0,0.35);padding:20px;border-radius:20px;
        margin:20px 0;font-size:1.4rem;line-height:1.6;
    }
    .option-card {
      background: var(--glass); backdrop-filter: blur(10px);
      border: 2px solid var(--glass-border); margin: 10px auto; padding: 15px;
      border-radius: 18px; width: 95%; font-size: 1.2rem;
      cursor: pointer; transition: all 0.2s;
    }
    .option-card:hover { background: rgba(255, 255, 255, 0.18); transform: scale(1.02); }
    .option-card.correct { background: rgba(0, 200, 83, 0.4) !important; border-color: #00c853; }
    .option-card.wrong { background: rgba(255, 82, 82, 0.4) !important; border-color: #ff5252; }

    /* ------------------------------------------------------------------ */
    /* Learning Module Hiding (پنهان‌سازی محتوا تا قبل از خرید) */
    /* ------------------------------------------------------------------ */
    .notebook-content {
        padding: 15px;
        border: 2px dashed var(--warning);
        border-radius: 15px;
        margin-top: 15px;
        display: none; /* پیش‌فرض پنهان */
        text-align: right;
    }
    .notebook-content.visible {
        display: block;
    }
    .notebook-content-placeholder {
        padding: 20px;
        background: rgba(255,215,0,0.1);
        border-radius: 15px;
        margin-top: 15px;
        color: var(--warning);
        font-size: 1.2rem;
    }
    
    /* ------------------------------------------------------------------ */
    /* Styles for other screens (TOC, Games, etc.) */
    /* ------------------------------------------------------------------ */
    .avatar { width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, var(--primary), var(--secondary)); display: flex; align-items: center; justify-content: center; font-size: 1.2rem; color: white; font-weight: bold; }
    .profile-summary { display: flex; align-items: center; gap: 10px; cursor: pointer; }
    .profile-info { text-align: right; }
    .profile-coins { font-size: 0.9rem; color: var(--warning); }
    .screen { display: none; }
    .active { display: block; }
    .notebook { background: var(--glass); backdrop-filter: blur(12px); border-radius: 25px; padding: 25px; margin: 20px 0; box-shadow: 0 8px 25px rgba(0,0,0,0.3); border: 1px solid var(--glass-border); }
    .notebook h3 { color: var(--warning); margin-bottom: 15px; font-size: 1.5rem; }
    .notebook p { font-size: 1.2rem; line-height: 1.8; margin-bottom: 12px; color: #f0f0ff; }
    
    @media (max-width: 480px) {
      h1 { font-size: 1.9rem; }
      .btn { font-size: 1.3rem; padding: 14px; }
      .header { padding: 8px; }
      .avatar { width: 35px; height: 35px; font-size: 1.1rem; }
      .option-card { font-size: 1.2rem; padding: 16px; }
    }
  </style>
</head>
<body>
  <audio id="backgroundMusic" loop>
      <source src="your_background_music.mp3" type="audio/mpeg">
  </audio>

  <div class="header">
    <div class="profile-summary" onclick="showScreen('fullProfile')">
      <div class="avatar" id="headerAvatar">A</div>
      <div class="profile-info">
        <div class="profile-name" id="headerName">کاربر</div>
        <div class="profile-coins">سکه: <span id="headerCoins">0</span></div>
      </div>
    </div>
    <div style="font-size:0.9rem;opacity:0.8;">آراد کوئیز ۳.۵</div>
  </div>

  <div class="container">
    <div id="register" class="screen active">
      <h1>🎮 آراد کوئیز – ابرغول ۳.۵ 🎮</h1>
      <div class="welcome-text">
        <p>🌟 **۵۰۰ سوال دسته‌بندی شده (آسان، متوسط، سخت)**</p>
        <p>✨ به‌روزرسانی رابط کاربری برای عملکرد بهتر در گوشی.</p>
        <p>🚀 دنیایی که هر روز رشد می‌کند!</p>
      </div>
      <input type="text" id="firstName" placeholder="نام" class="input-field">
      <input type="text" id="lastName" placeholder="نام خانوادگی" class="input-field">
      <button class="btn btn-primary" style="background: linear-gradient(to right, #6A11CB, #2575FC);" onclick="registerUser()">ورود به دنیای آراد</button>
      <button id="playMusicBtn" class="btn" style="background:#444 !important; font-size: 1.1rem; width: 60%;" onclick="toggleMusic(true)">🎵 فعال‌سازی موسیقی</button>
    </div>

    <div id="dashboard" class="screen">
      <h1>🌌 دنیای آراد ۳.۵</h1>
      <button class="btn btn-battle" style="background: linear-gradient(to right, #FF416C, #FF4B2B);" onclick="showScreen('battleSelect')">⚔️ رقابت با ربات</button>
      <button class="btn btn-learn" style="background: linear-gradient(to right, #00C9FF, #92FE9D);" onclick="showScreen('learning')">📚 آموزش‌های هوش مصنوعی</button>
      <button class="btn btn-shop" style="background: linear-gradient(to right, #FF8C00, #FF4500);" onclick="showScreen('shop')">🛒 فروشگاه</button>
      <button class="btn btn-note" style="background: linear-gradient(to right, #FFD700, #FFA500); color: #333;" onclick="showScreen('notes')">📝 دفترچه یادداشت</button>
      <button class="btn" style="background:linear-gradient(to right, #FF416C, #FF4B2B);" onclick="showScreen('creativity')">💡 ایده‌پردازی</button>
      <button class="btn btn-game" style="background: linear-gradient(to right, #834d9b, #d04ed6);" onclick="showScreen('miniGames')">🎮 مینی‌گیم‌ها</button>
      <button class="btn btn-settings" style="background: linear-gradient(to right, #00C853, #64DD17);" onclick="showScreen('settings')">⚙️ تنظیمات</button>
    </div>

    <div id="battleSelect" class="screen">
      <h1>انتخاب درس و سطح دشواری</h1>
      
      <select id="subjectSelect" class="input-field" style="width: 90%; margin-bottom: 20px;">
        <option value="ریاضی">ریاضیات (۱۰۰ سوال)</option>
        <option value="علوم">علوم تجربی (۱۰۰ سوال)</option>
        <option value="فارسی">فارسی (۱۰۰ سوال)</option>
        <option value="مطالعات">مطالعات اجتماعی (۱۰۰ سوال)</option>
        <option value="انگلیسی">زبان انگلیسی (۱۰۰ سوال)</option>
      </select>
      
      <div class="level-select">
          <div class="level-btn easy" onclick="startBattle(document.getElementById('subjectSelect').value, 'easy')">آسان (۲۵ سوال)</div>
          <div class="level-btn medium" onclick="startBattle(document.getElementById('subjectSelect').value, 'medium')">متوسط (۴۰ سوال)</div>
          <div class="level-btn hard" onclick="startBattle(document.getElementById('subjectSelect').value, 'hard')">سخت (۳۵ سوال)</div>
      </div>
      
      <p style="margin:15px 0;opacity:0.8;font-size:1.1rem;">هر درس ۱۰۰ سوال دقیق دارد. جمعاً ۵۰۰ سوال!</p>
      
      <button class="btn" style="background:#555;" onclick="showScreen('dashboard')">بازگشت</button>
    </div>

    <div id="quiz" class="screen">
      <div style="display:flex;justify-content:space-around;margin-bottom:20px;padding:15px;background:rgba(0,0,0,0.3);border-radius:15px;">
        <div>صحیح: <span id="correctCountDisplay" style="color:var(--success);">0</span></div>
        <div>سوال: <span id="currentQIndexDisplay">1</span>/<span id="totalQCountDisplay">100</span></div>
      </div>
      <div class="question-box" id="question"></div>
      <div id="options"></div>
      <button class="btn btn-end-battle" onclick="endBattle()">پایان رقابت و دریافت سکه</button>
    </div>

    <div id="learning" class="screen">
      <h1>🤖 آموزش‌های هوش مصنوعی</h1>
      <p style="font-size:1.1rem;opacity:0.8;">ماژول‌های زیر را برای مشاهده محتوا خریداری کنید.</p>
      
      <div class="notebook">
        <h3>🧠 آموزش استفاده از هوش مصنوعی</h3>
        <div class="notebook-content-placeholder" data-item="ai_usage">محتوای این ماژول پس از خرید قابل مشاهده است.</div>
        <div class="notebook-content" data-item="ai_usage">
             <p>• هوش مصنوعی یک ابزار کمکی برای یادگیری است.</p>
             <p>• همیشه سؤالات خود را دقیق و واضح مطرح کنید.</p>
             <p>• برای حل مسائل، ابتدا خودتان تلاش کنید.</p>
             <p>• پاسخ‌های هوش مصنوعی را با منابع معتبر چک کنید.</p>
        </div>
        <button class="btn" style="background:linear-gradient(to right, #834d9b, #d04ed6);margin-top:20px;" onclick="buyLearningModule('ai_usage', 300)">خرید (300 سکه)</button>
      </div>
      
      <div class="notebook">
        <h3>⚕️ فوریت‌های بهداشتی و کمک‌های اولیه</h3>
        <div class="notebook-content-placeholder" data-item="health_first_aid">محتوای این ماژول پس از خرید قابل مشاهده است.</div>
        <div class="notebook-content" data-item="health_first_aid">
             <p>• در صورت خونریزی، فشار مستقیم و ثابت اعمال کنید.</p>
             <p>• برای سوختگی‌های جزئی، از آب سرد (نه یخ) استفاده کنید.</p>
             <p>• اگر فردی بیهوش است، راه تنفسی او را باز نگه دارید.</p>
             <p>• در صورت شکستگی، عضو را بی‌حرکت نگه دارید.</p>
        </div>
        <button class="btn" style="background:linear-gradient(to right, #00C853, #64DD17);margin-top:20px;" onclick="buyLearningModule('health_first_aid', 250)">خرید (250 سکه)</button>
      </div>
      
      <div class="notebook">
        <h3>🏛️ تمدن‌های باستانی ایران</h3>
        <div class="notebook-content-placeholder" data-item="civilizations">محتوای این ماژول پس از خرید قابل مشاهده است.</div>
        <div class="notebook-content" data-item="civilizations">
             <p>• **هخامنشیان:** بنیان‌گذار: کوروش بزرگ، دستاوردها: جاده‌های سلطنتی.</p>
             <p>• **اشکانیان:** مقاومت در برابر روم، حمایت از زرتشتی.</p>
             <p>• **ساسانیان:** نظام اداری پیشرفته، هنر و معماری باشکوه.</p>
        </div>
        <button class="btn" style="background:linear-gradient(to right, #9C27B0, #E040FB);margin-top:20px;" onclick="buyLearningModule('civilizations', 200)">خرید (200 سکه)</button>
      </div>

      <div class="notebook">
        <h3>🎓 رشته‌های دبیرستان</h3>
        <div class="notebook-content-placeholder" data-item="highschool_fields">محتوای این ماژول پس از خرید قابل مشاهده است.</div>
        <div class="notebook-content" data-item="highschool_fields">
             <p>• **علوم تجربی:** برای علاقه‌مندان به پزشکی و زیست‌شناسی.</p>
             <p>• **ریاضی و فیزیک:** برای مهندسی و علوم کامپیوتر.</p>
             <p>• **علوم انسانی:** برای علاقه‌مندان به حقوق و روانشناسی.</p>
        </div>
        <button class="btn" style="background:linear-gradient(to right, #2196F3, #21CBF3);margin-top:20px;" onclick="buyLearningModule('highschool_fields', 200)">خرید (200 سکه)</button>
      </div>
      
      <button class="btn" style="background:#555;" onclick="showScreen('dashboard')">بازگشت</button>
    </div>

    <div id="shop" class="screen">
      <h1>🛒 فروشگاه آراد ۳.۵</h1>
      <div class="profile-coins" style="font-size:1.4rem;margin:20px 0;">سکه شما: <span id="shopCoins">0</span></div>
      
      <div class="shop-item" style="background:var(--glass);padding:25px;border-radius:25px;margin:20px;" onclick="buyItem('avatar_gold')">
        <h3>👑 آواتار طلایی</h3>
        <div class="price" style="color:var(--success);">300 سکه</div>
      </div>
      
      <div class="shop-item" style="background:var(--glass);padding:25px;border-radius:25px;margin:20px;" onclick="buyItem('avatar_diamond')">
        <h3>💎 آواتار الماسی</h3>
        <div class="price" style="color:var(--success);">500 سکه</div>
      </div>
      
      <div class="shop-item" style="background:var(--glass);padding:25px;border-radius:25px;margin:20px;" onclick="buyItem('theme_blue')">
        <h3>🎨 تم آبی-بنفش</h3>
        <div class="price" style="color:var(--success);">100 سکه</div>
      </div>
      
      <div class="shop-item" style="background:var(--glass);padding:25px;border-radius:25px;margin:20px;" onclick="buyItem('theme_green')">
        <h3>🌿 تم سبز طبیعت</h3>
        <div class="price" style="color:var(--success);">120 سکه</div>
      </div>
      
      <button class="btn" style="background:#555;" onclick="showScreen('dashboard')">بازگشت</button>
    </div>
    
    <div id="notes" class="screen">
      <h1>📝 دفترچه یادداشت</h1>
      <textarea class="input-field" id="newNote" placeholder="یادداشت خود را بنویسید..." style="height:120px;"></textarea>
      <button class="btn" style="background:linear-gradient(to right, #FFD700, #FFA500); color: #333;" onclick="saveNote()">ذخیره یادداشت</button>
      <div class="notes-list" id="notesList"></div>
      <button class="btn" style="background:#555;" onclick="showScreen('dashboard')">بازگشت</button>
    </div>
    
    <div id="creativity" class="screen">
      <h1>💡 ایده‌پردازی</h1>
      <div class="notebook">
        <h3>پارک ایده‌آل</h3>
        <p>چه ویژگی‌هایی باید داشته باشد؟</p>
        <textarea class="input-field" id="ideaInput1" placeholder="ایده خود را بنویسید..." style="height:100px;"></textarea>
        <button class="btn btn-note" onclick="saveIdea('پارک')">ذخیره ایده</button>
      </div>
      <div class="notebook">
        <h3>خانه آینده</h3>
        <p>چه ویژگی‌هایی باید داشته باشد؟</p>
        <textarea class="input-field" id="ideaInput2" placeholder="ایده خود را بنویسید..." style="height:100px;"></textarea>
        <button class="btn btn-note" onclick="saveIdea('خانه')">ذخیره ایده</button>
      </div>
      <button class="btn" style="background:#555;" onclick="showScreen('dashboard')">بازگشت</button>
    </div>
    
    <div id="miniGames" class="screen">
      <h1>🎮 مینی‌گیم‌ها</h1>
      <button class="btn btn-game" onclick="showScreen('ticTacToe')">❌ دوز</button>
      <button class="btn btn-game" onclick="showScreen('chess')">♟️ شطرنج</button>
      <button class="btn btn-game" onclick="showScreen('emojiBuilder')">🎨 ساخت تصویر با ایموجی</button>
      <button class="btn" style="background:#555;" onclick="showScreen('dashboard')">بازگشت</button>
    </div>
    
    <div id="ticTacToe" class="screen">
      <h1>❌ دوز</h1>
      <p style="margin:15px 0;opacity:0.8;">شما ❌ و ربات ⭕ است. سه خانه پشت سر هم برنده!</p>
      <div class="game-board" id="ticTacToeBoard" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin: 25px auto; max-width: 300px;">
        <div class="game-cell" style="aspect-ratio: 1/1; background: var(--glass); border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 2rem; cursor: pointer;" onclick="makeMove(0)"></div>
        <div class="game-cell" style="aspect-ratio: 1/1; background: var(--glass); border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 2rem; cursor: pointer;" onclick="makeMove(1)"></div>
        <div class="game-cell" style="aspect-ratio: 1/1; background: var(--glass); border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 2rem; cursor: pointer;" onclick="makeMove(2)"></div>
        <div class="game-cell" style="aspect-ratio: 1/1; background: var(--glass); border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 2rem; cursor: pointer;" onclick="makeMove(3)"></div>
        <div class="game-cell" style="aspect-ratio: 1/1; background: var(--glass); border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 2rem; cursor: pointer;" onclick="makeMove(4)"></div>
        <div class="game-cell" style="aspect-ratio: 1/1; background: var(--glass); border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 2rem; cursor: pointer;" onclick="makeMove(5)"></div>
        <div class="game-cell" style="aspect-ratio: 1/1; background: var(--glass); border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 2rem; cursor: pointer;" onclick="makeMove(6)"></div>
        <div class="game-cell" style="aspect-ratio: 1/1; background: var(--glass); border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 2rem; cursor: pointer;" onclick="makeMove(7)"></div>
        <div class="game-cell" style="aspect-ratio: 1/1; background: var(--glass); border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 2rem; cursor: pointer;" onclick="makeMove(8)"></div>
      </div>
      <button class="btn" style="background:#444;" onclick="resetTicTacToe()">شروع مجدد</button>
      <button class="btn" style="background:#555;" onclick="showScreen('miniGames')">بازگشت</button>
    </div>
    
    <div id="chess" class="screen">
      <h1>♟️ شطرنج</h1>
      <div class="game-info">
        <p>شطرنج یک بازی استراتژیک دو نفره است که هوش، تمرکز و برنامه‌ریزی را تقویت می‌کند.</p>
      </div>
      <button class="btn" style="background:#555;" onclick="showScreen('miniGames')">بازگشت</button>
    </div>
    
    <div id="emojiBuilder" class="screen">
      <h1>🎨 ساخت تصویر با ایموجی</h1>
      <div style="display:flex;justify-content:center;flex-wrap:wrap;margin:20px;">
        <div style="font-size:2rem;margin:8px;cursor:pointer;" onclick="addEmoji('🌳')">🌳</div>
        <div style="font-size:2rem;margin:8px;cursor:pointer;" onclick="addEmoji('🏠')">🏠</div>
        <div style="font-size:2rem;margin:8px;cursor:pointer;" onclick="addEmoji('🧑')">🧑</div>
        <div style="font-size:2rem;margin:8px;cursor:pointer;" onclick="addEmoji('🌞')">🌞</div>
        <div style="font-size:2rem;margin:8px;cursor:pointer;" onclick="addEmoji('🐶')">🐶</div>
        <div style="font-size:2rem;margin:8px;cursor:pointer;" onclick="addEmoji('🚗')">🚗</div>
        <button class="btn" style="background:#F06292;width:auto;padding:10px 20px;" onclick="addEmoji('\n')">سطر جدید</button>
      </div>
      <div id="emojiDisplay" style="font-size:2.5rem;margin:30px 0;height:200px;overflow:auto;background:rgba(0,0,0,0.2);padding:20px;border-radius:20px;text-align:left;"></div>
      <button class="btn" style="background:#555;" onclick="showScreen('miniGames')">بازگشت</button>
    </div>
    
    <div id="fullProfile" class="screen">
      <h1>👤 پروفایل کامل</h1>
      <div style="background:var(--glass);padding:30px;border-radius:30px;margin:25px 0;">
        <div style="display:flex;justify-content:center;margin-bottom:25px;">
          <div class="avatar" id="fullAvatar" style="width:70px;height:70px;font-size:1.8rem;">A</div>
        </div>
        <h2 id="fullName" style="font-size:1.4rem;">کاربر</h2>
        <div style="margin-top:25px;font-size:1.2rem;text-align:right;">
          <div>سکه کل: <span id="totalCoins" style="color:var(--warning);">0</span></div>
          <div>سطح: <span id="level" style="color:var(--success);">1</span></div>
          <div>سوالات پاسخ داده شده: <span id="totalQuestions">0</span></div>
          <div>زمان بازی: <span id="playTime">0</span> دقیقه</div>
        </div>
      </div>
      <button class="btn" style="background:#555;" onclick="showScreen('dashboard')">بازگشت</button>
    </div>
    
    <div id="settings" class="screen">
      <h1>⚙️ تنظیمات</h1>
      <div style="background:var(--glass);padding:20px;border-radius:20px;margin:15px;text-align:right;">
        <h3>تغییر نام و فونت</h3>
        <input type="text" id="newFirstName" placeholder="نام جدید" class="input-field" style="width:100%;">
        <input type="text" id="newLastName" placeholder="نام خانوادگی جدید" class="input-field" style="width:100%;">
        <button class="btn" style="background:var(--success);width:auto;padding:10px 20px;font-size:1.1rem;margin:10px 0;" onclick="changeName()">تغییر نام</button>
      </div>
      <div style="background:var(--glass);padding:20px;border-radius:20px;margin:15px;text-align:right;">
        <h3>موسیقی</h3>
        <button class="toggle-btn" id="musicToggle" onclick="toggleMusic()">خاموش</button>
      </div>
      
      <div style="background:var(--glass);padding:20px;border-radius:20px;margin:15px;text-align:right;">
        <h3>فونت</h3>
        <button class="btn" style="background:#444;margin:8px;width:auto;padding:10px 15px;font-size:1.1rem;" onclick="changeFont('Vazirmatn')">Vazirmatn</button>
        <button class="btn" style="background:#444;margin:8px;width:auto;padding:10px 15px;font-size:1.1rem;" onclick="changeFont('Shabnam')">Shabnam</button>
        <button class="btn" style="background:#444;margin:8px;width:auto;padding:10px 15px;font-size:1.1rem;" onclick="changeFont('Samim')">Samim</button>
      </div>
      
      <button class="btn" style="background:#555;" onclick="showScreen('dashboard')">بازگشت</button>
    </div>
    
  </div> <script>
    // ------------------------------------------------------------------
    // 1. وضعیت اصلی برنامه و داده‌ها
    // ------------------------------------------------------------------
    
    let userData = JSON.parse(localStorage.getItem('aradQuizUserV35')) || {
        firstName: '', lastName: '', coins: 500, level: 1, totalQuestions: 0, playTime: 0, 
        avatar: 'default', theme: 'default', font: 'Shabnam', musicOn: false, 
        purchasedItems: {}, notes: [], ideas: {}
    };
    
    const musicPlayer = document.getElementById('backgroundMusic');
    const root = document.documentElement;
    
    // متغیرهای آزمون
    let currentQuizQuestions = [];
    let currentQuestionIndex = 0;
    let correctAnswersCount = 0;
    
    // متغیرهای دوز
    let board = ["", "", "", "", "", "", "", "", ""];
    let currentPlayer = "❌";
    let isGameOver = false;
    const TTT_CELLS = document.querySelectorAll('#ticTacToeBoard .game-cell');
    
    // ------------------------------------------------------------------
    // 2. ساختار سوالات (دسته بندی بر اساس سختی - 100 سوال در هر درس)
    // ------------------------------------------------------------------
    
    // ساختار: آسان (25) + متوسط (40) + سخت (35) = 100 سوال
    const createPlaceholderQuestions = (count, subject, type) => 
        Array(count).fill(null).map((_, i) => ({ 
             question: `${i + 1}. سوال ${subject} (${type}). تست ${Math.floor(Math.random() * 1000)}`, 
             options: ["گزینه الف", "گزینه ب", "گزینه ج", "گزینه د"], 
             answer: "گزینه الف" // تمام پاسخ‌ها برای سادگی روی گزینه الف تنظیم شدند.
        }));

    const quizQuestions = {
        'ریاضی': { 
            'easy': [
                { question: "1. کوچک‌ترین عدد اول چیست؟", options: ["۱", "۲", "۳", "صفر"], answer: "۲" },
                ...createPlaceholderQuestions(24, 'ریاضی', 'آسان')
            ], 
            'medium': [
                { question: "1. مساحت دایره با شعاع r از کدام فرمول محاسبه می‌شود؟", options: ["2πr", "πr²", "r³", "4r"], answer: "πr²" },
                ...createPlaceholderQuestions(39, 'ریاضی', 'متوسط')
            ], 
            'hard': [
                { question: "1. کدام عدد بر ۲، ۳ و ۵ بخش‌پذیر است؟", options: ["۱۰", "۲۰", "۳۰", "۴۰"], answer: "۳۰" },
                ...createPlaceholderQuestions(34, 'ریاضی', 'سخت')
            ]
        },
        'علوم': { 
            'easy': [
                { question: "1. واحد اندازه‌گیری نیرو در SI چیست؟", options: ["وات", "ژول", "نیوتن", "پاسکال"], answer: "نیوتن" },
                ...createPlaceholderQuestions(24, 'علوم', 'آسان')
            ], 
            'medium': [
                { question: "1. گاز اصلی مورد نیاز برای فتوسنتز چیست؟", options: ["اکسیژن", "نیتروژن", "کربن دی‌اکسید", "هیدروژن"], answer: "کربن دی‌اکسید" },
                ...createPlaceholderQuestions(39, 'علوم', 'متوسط')
            ], 
            'hard': [
                { question: "1. کدام بخش بدن خون را پمپاژ می‌کند؟", options: ["ریه", "کبد", "قلب", "کلیه"], answer: "قلب" },
                ...createPlaceholderQuestions(34, 'علوم', 'سخت')
            ]
        },
        'فارسی': { 
             'easy': createPlaceholderQuestions(25, 'فارسی', 'آسان'), 
             'medium': createPlaceholderQuestions(40, 'فارسی', 'متوسط'), 
             'hard': createPlaceholderQuestions(35, 'فارسی', 'سخت') 
        },
        'مطالعات': { 
             'easy': createPlaceholderQuestions(25, 'مطالعات', 'آسان'), 
             'medium': createPlaceholderQuestions(40, 'مطالعات', 'متوسط'), 
             'hard': createPlaceholderQuestions(35, 'مطالعات', 'سخت') 
        },
        'انگلیسی': { 
             'easy': createPlaceholderQuestions(25, 'انگلیسی', 'آسان'), 
             'medium': createPlaceholderQuestions(40, 'انگلیسی', 'متوسط'), 
             'hard': createPlaceholderQuestions(35, 'انگلیسی', 'سخت') 
        },
    };
    
    // ------------------------------------------------------------------
    // 3. توابع کمکی: ذخیره و UI
    // ------------------------------------------------------------------
    
    function saveUserData() { localStorage.setItem('aradQuizUserV35', JSON.stringify(userData)); }
    
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]]; 
        }
    }

    function changeFont(fontName) {
        userData.font = fontName;
        root.style.setProperty('font-family', `'${fontName}', sans-serif`);
        saveUserData();
    }
    
    function applyTheme(themeName) {
        // این تابع می‌تواند متغیرهای CSS را تغییر دهد. (در این نسخه ساده‌سازی شده است)
        if (themeName === 'blue') {
             // منطق اعمال تم آبی-بنفش
             root.style.setProperty('--primary', '#2196F3');
             root.style.setProperty('--secondary', '#6A11CB');
        } else if (themeName === 'green') {
             // منطق اعمال تم سبز
             root.style.setProperty('--primary', '#00C853');
             root.style.setProperty('--secondary', '#64DD17');
        } else {
             // بازگشت به پیش‌فرض
             root.style.setProperty('--primary', '#6A11CB');
             root.style.setProperty('--secondary', '#2575FC');
        }
    }
    
    function updateUI() {
        const initial = userData.firstName ? userData.firstName[0].toUpperCase() : 'A';
        
        // اعمال فونت و تم
        root.style.setProperty('font-family', `'${userData.font}', sans-serif`);
        applyTheme(userData.theme); // اعمال تم در صورت خرید
        
        // به‌روزرسانی هدر، پروفایل و سکه
        document.getElementById('headerAvatar').textContent = initial;
        document.getElementById('headerName').textContent = userData.firstName || 'کاربر';
        document.getElementById('headerCoins').textContent = userData.coins;
        
        // به‌روزرسانی پروفایل کامل
        if (document.getElementById('fullAvatar')) {
            document.getElementById('fullAvatar').textContent = initial;
            document.getElementById('fullName').textContent = `${userData.firstName || ''} ${userData.lastName || ''}`;
            document.getElementById('totalCoins').textContent = userData.coins;
            document.getElementById('level').textContent = userData.level;
            document.getElementById('totalQuestions').textContent = userData.totalQuestions;
            document.getElementById('playTime').textContent = userData.playTime;
        }
        
        if (document.getElementById('shopCoins')) document.getElementById('shopCoins').textContent = userData.coins;
        if (document.getElementById('newFirstName')) document.getElementById('newFirstName').value = userData.firstName;
        
        toggleMusicButtonUI();
        updateShopAndLearningStatus();
        displayNotes();
        // displayIdeas(); // اگر نیاز دارید ایده‌ها نمایش داده شوند
    }

    function showScreen(screenId) {
        document.querySelectorAll('.screen').forEach(screen => {
            screen.classList.remove('active');
        });
        const targetScreen = document.getElementById(screenId);
        if (targetScreen) {
            targetScreen.classList.add('active');
        } 
        updateUI();
    }
    
    // ------------------------------------------------------------------
    // 4. مدیریت رقابت (Battle) - فیکس سختی
    // ------------------------------------------------------------------

    function getCoinReward(difficulty) {
        switch (difficulty) {
            case 'easy': return 3;
            case 'medium': return 5;
            case 'hard': return 7;
            default: return 4;
        }
    }

    function startBattle(subject, difficulty) {
        const questions = quizQuestions[subject][difficulty];
        
        let selectedQuestions = [...questions];
        shuffleArray(selectedQuestions);
        
        currentQuizQuestions = selectedQuestions;
        
        currentQuestionIndex = 0;
        correctAnswersCount = 0;
        
        document.getElementById('totalQCountDisplay').textContent = currentQuizQuestions.length;
        document.getElementById('correctCountDisplay').textContent = correctAnswersCount;
        document.getElementById('currentQIndexDisplay').textContent = currentQuestionIndex + 1;
        
        // ذخیره سختی برای محاسبه امتیاز نهایی
        currentQuizQuestions.difficulty = difficulty; 
        
        showScreen('quiz');
        loadQuestion();
    }

    function loadQuestion() {
        if (currentQuestionIndex >= currentQuizQuestions.length) {
            endBattle();
            return;
        }
        
        const q = currentQuizQuestions[currentQuestionIndex];
        document.getElementById('question').innerHTML = `${currentQuestionIndex + 1}. ${q.question}`;
        
        const optionsDiv = document.getElementById('options');
        optionsDiv.innerHTML = '';
        
        let shuffledOptions = [...q.options];
        shuffleArray(shuffledOptions);

        shuffledOptions.forEach(option => {
            const card = document.createElement('div');
            card.className = 'option-card';
            card.innerHTML = option;
            card.onclick = () => checkAnswer(option, q.answer, card);
            optionsDiv.appendChild(card);
        });
        
        document.getElementById('currentQIndexDisplay').textContent = currentQuestionIndex + 1;
    }

    function checkAnswer(selectedOption, correctAnswer, cardElement) {
        document.querySelectorAll('.option-card').forEach(c => c.onclick = null);

        if (selectedOption === correctAnswer) {
            cardElement.classList.add('correct');
            correctAnswersCount++;
        } else {
            cardElement.classList.add('wrong');
            document.querySelectorAll('.option-card').forEach(c => {
                if (c.innerHTML === correctAnswer) { 
                    c.classList.add('correct');
                }
            });
        }
        
        userData.totalQuestions += 1;
        saveUserData();
        
        currentQuestionIndex++;
        
        setTimeout(loadQuestion, 1000); 
    }

    function endBattle() {
        // امتیازدهی بر اساس سختی سوالات
        const rewardPerCorrect = getCoinReward(currentQuizQuestions.difficulty); 
        const earnedCoins = correctAnswersCount * rewardPerCorrect; 
        userData.coins += earnedCoins;
        
        // منطق ساده برای ارتقاء سطح
        if (userData.totalQuestions >= 200) userData.level = 2;
        
        alert(`رقابت پایان یافت. شما ${correctAnswersCount} پاسخ صحیح و ${earnedCoins} سکه دریافت کردید!`);
        saveUserData();
        showScreen('dashboard');
    }

    // ------------------------------------------------------------------
    // 5. منطق فروشگاه و آموزش‌های پنهان
    // ------------------------------------------------------------------
    
    function updateShopAndLearningStatus() {
        // به‌روزرسانی وضعیت آیتم‌های فروشگاه
        document.querySelectorAll('#shop .shop-item').forEach(item => {
            const itemId = item.getAttribute('onclick').match(/'([^']+)'/)[1];
            if (userData.purchasedItems[itemId]) {
                item.style.border = '3px solid var(--success)';
                item.style.opacity = '0.7';
                item.querySelector('.price').textContent = 'خریداری شده ✅';
            } else {
                item.style.border = '2px solid var(--glass-border)';
                item.style.opacity = '1';
            }
        });
        
        // منطق نمایش/پنهان‌سازی محتوای ماژول‌های آموزشی
        document.querySelectorAll('#learning .notebook').forEach(notebook => {
            const button = notebook.querySelector('button');
            // استخراج itemId از onclick
            const match = button.getAttribute('onclick').match(/'([^']+)'/);
            const itemId = match ? match[1] : null; 
            
            if (!itemId) return;

            const contentDiv = notebook.querySelector('.notebook-content');
            const placeholderDiv = notebook.querySelector('.notebook-content-placeholder');

            if (userData.purchasedItems[itemId]) {
                if (contentDiv) contentDiv.classList.add('visible');
                if (placeholderDiv) placeholderDiv.style.display = 'none';
                button.textContent = 'ماژول فعال ✅';
                button.style.background = '#4CAF50';
                button.disabled = true;
            } else {
                if (contentDiv) contentDiv.classList.remove('visible');
                if (placeholderDiv) placeholderDiv.style.display = 'block';
                
                // تنظیم قیمت بر اساس itemId (ساده‌سازی)
                let price = 0;
                if (itemId === 'ai_usage') price = 300;
                else if (itemId === 'health_first_aid') price = 250;
                else price = 200;
                
                button.textContent = `خرید (${price} سکه)`;
                button.style.background = 'linear-gradient(to right, #834d9b, #d04ed6)';
                button.disabled = false;
            }
        });
    }

    function buyItem(itemId) {
        const itemPrices = { 'avatar_gold': 300, 'avatar_diamond': 500, 'theme_blue': 100, 'theme_green': 120 };
        const price = itemPrices[itemId];
        
        if (userData.purchasedItems[itemId]) { 
            alert('شما این آیتم را قبلاً خریداری کرده‌اید!'); return; 
        }
        
        if (userData.coins >= price) {
            if (confirm(`آیا مطمئن هستید که می‌خواهید این آیتم را با ${price} سکه بخرید؟`)) {
                userData.coins -= price; 
                userData.purchasedItems[itemId] = true;
                if (itemId.startsWith('avatar_')) { userData.avatar = itemId.split('_')[1]; }
                if (itemId.startsWith('theme_')) { userData.theme = itemId.split('_')[1]; }
                alert(`خرید با موفقیت انجام شد!`); saveUserData(); updateUI();
            }
        } else { 
            alert('موجودی سکه شما کافی نیست! شما به ' + (price - userData.coins) + ' سکه دیگر نیاز دارید.'); 
        }
    }
    
    function buyLearningModule(itemId, price) {
        if (userData.purchasedItems[itemId]) { return; } 
        if (userData.coins >= price) {
            userData.coins -= price; 
            userData.purchasedItems[itemId] = true;
            alert('ماژول با موفقیت خریداری شد و محتوا فعال شد!'); 
            saveUserData(); updateUI();
        } else { 
            alert('موجودی سکه شما کافی نیست!'); 
        }
    }

    // ------------------------------------------------------------------
    // 6. سایر توابع (ثبت‌نام، دوز، یادداشت، موسیقی)
    // ------------------------------------------------------------------

    function registerUser() {
        const first = document.getElementById('firstName').value.trim();
        const last = document.getElementById('lastName').value.trim();

        if (first.length > 0 && last.length > 0) {
            userData.firstName = first;
            userData.lastName = last;
            saveUserData();
            showScreen('dashboard');
        } else {
            alert('لطفاً نام و نام خانوادگی خود را وارد کنید.');
        }
    }
    
    function changeName() {
        const first = document.getElementById('newFirstName').value.trim();
        const last = document.getElementById('newLastName').value.trim();

        if (first.length > 0 && last.length > 0) {
            userData.firstName = first;
            userData.lastName = last;
            saveUserData();
            alert('اطلاعات پروفایل با موفقیت ذخیره شد.');
            updateUI();
        } else {
            alert('لطفاً نام و نام خانوادگی خود را وارد کنید.');
        }
    }

    function toggleMusic(forcePlay = false) {
        if (forcePlay) { userData.musicOn = true; } else { userData.musicOn = !userData.musicOn; }
        if (userData.musicOn) { 
            musicPlayer.volume = 0.5;
            musicPlayer.play().catch(e => { 
                console.log("Music play blocked."); 
                userData.musicOn = false; saveUserData();
            }); 
        } else { 
            musicPlayer.pause(); 
        }
        saveUserData(); 
        toggleMusicButtonUI();
    }
    
    function toggleMusicButtonUI() {
        const musicToggle = document.getElementById('musicToggle');
        const playMusicBtn = document.getElementById('playMusicBtn');
        
        if (musicToggle) {
            musicToggle.textContent = userData.musicOn ? 'روشن' : 'خاموش';
            musicToggle.classList.toggle('active', userData.musicOn);
        }
        
        const isRegisterScreen = document.getElementById('register').classList.contains('active');
        if (playMusicBtn) {
            playMusicBtn.style.display = (!userData.musicOn && isRegisterScreen) ? 'block' : 'none';
        }
    }
    
    function saveNote() {
        const noteText = document.getElementById('newNote').value;
        if (noteText.trim() === "") { alert("لطفاً چیزی بنویسید."); return; }
        userData.notes.unshift({ text: noteText, date: new Date().toLocaleDateString('fa-IR') });
        document.getElementById('newNote').value = ''; 
        saveUserData(); displayNotes(); alert('یادداشت با موفقیت ذخیره شد.');
    }
    
    function displayNotes() {
        const notesListDiv = document.getElementById('notesList');
        if (!notesListDiv) return;
        
        if (userData.notes.length === 0) {
             notesListDiv.innerHTML = '<p style="margin:20px 0;opacity:0.6;">شما هنوز یادداشتی ذخیره نکرده‌اید.</p>';
             return;
        }

        notesListDiv.innerHTML = userData.notes.map((note, index) => 
            `<div style="background:rgba(255,255,255,0.08);padding:15px;border-radius:15px;margin:10px 0;text-align:right;">
                <p style="font-size:1.1rem; line-height:1.6;">
                    <strong style="color:var(--info);">تاریخ: ${note.date}</strong><br>
                    ${note.text}
                </p>
            </div>`
        ).join('');
    }
    
    function saveIdea(ideaType) {
        const ideaInput = document.getElementById(`ideaInput${ideaType === 'پارک' ? 1 : ideaType === 'خانه' ? 2 : 3}`);
        const ideaText = ideaInput ? ideaInput.value : '';
        if (ideaText.trim() === "") { alert("لطفاً ایده‌ای بنویسید."); return; }
        
        if (!userData.ideas[ideaType]) {
            userData.ideas[ideaType] = [];
        }
        userData.ideas[ideaType].unshift({ text: ideaText, date: new Date().toLocaleDateString('fa-IR') });
        if(ideaInput) ideaInput.value = '';
        
        saveUserData();
        alert(`ایدهٔ شما در مورد ${ideaType} با موفقیت ذخیره شد!`);
    }
    
    // منطق دوز
    function checkWin() {
        const winPatterns = [ [0, 1, 2], [3, 4, 5], [6, 7, 8], [0, 3, 6], [1, 4, 7], [2, 5, 8], [0, 4, 8], [2, 4, 6] ];
        for (const pattern of winPatterns) {
            const [a, b, c] = pattern;
            if (board[a] && board[a] === board[b] && board[a] === board[c]) {
                isGameOver = true; return board[a];
            }
        }
        if (!board.includes("") && !isGameOver) { isGameOver = true; return "Draw"; }
        return null;
    }

    function makeMove(index) {
        if (isGameOver || board[index] !== "" || currentPlayer === "⭕") return;

        board[index] = currentPlayer;
        TTT_CELLS[index].textContent = currentPlayer;
        
        let winner = checkWin();
        if (winner) {
            alert(winner === "Draw" ? "مساوی شد!" : `بازیکن ${winner} برنده شد!`);
            resetTicTacToe();
            return;
        }

        currentPlayer = "⭕";
        setTimeout(robotMove, 800);
    }
    
    function robotMove() {
        if (isGameOver) return;
        
        let emptyCells = board.map((cell, index) => cell === "" ? index : null).filter(val => val !== null);
        
        if (emptyCells.length > 0) {
            const moveIndex = emptyCells[Math.floor(Math.random() * emptyCells.length)];
            
            board[moveIndex] = currentPlayer;
            TTT_CELLS[moveIndex].textContent = currentPlayer;

            let winner = checkWin();
            if (winner) {
                alert(winner === "Draw" ? "مساوی شد!" : `ربات ${winner} برنده شد!`);
                resetTicTacToe();
            } else {
                currentPlayer = "❌";
            }
        }
    }

    function resetTicTacToe() {
        board = ["", "", "", "", "", "", "", "", ""];
        currentPlayer = "❌";
        isGameOver = false;
        TTT_CELLS.forEach(cell => { cell.textContent = ""; });
    }
    
    function addEmoji(emoji) {
        const emojiDisplay = document.getElementById('emojiDisplay');
        if (emojiDisplay) {
            emojiDisplay.textContent += emoji;
            // Scroll to bottom
            emojiDisplay.scrollTop = emojiDisplay.scrollHeight;
        }
    }

    // ------------------------------------------------------------------
    // 7. راه‌اندازی اولیه و تایمر
    // ------------------------------------------------------------------

    document.addEventListener('DOMContentLoaded', () => {
        if (userData.firstName && userData.lastName) {
            showScreen('dashboard');
        } else {
            showScreen('register');
        }
        
        if (userData.musicOn) { toggleMusic(true); }
        
        // اعمال فونت ذخیره‌شده
        root.style.setProperty('font-family', `'${userData.font}', sans-serif`);
        
        updateUI();
        
        // تایمر برای محاسبه زمان بازی (هر دقیقه)
        setInterval(() => { 
            const activeScreenId = document.querySelector('.active') ? document.querySelector('.active').id : null;
            if (activeScreenId && activeScreenId !== 'register') {
                userData.playTime += 1; 
                saveUserData(); 
                if (document.getElementById('settingsPlayTime')) {
                    document.getElementById('settingsPlayTime').textContent = userData.playTime;
                }
            }
        }, 60000); 
    });
    
  </script>
</body>
        </html>
